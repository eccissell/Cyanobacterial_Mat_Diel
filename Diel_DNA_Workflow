---
title: "Curated DNA Analysis Workflow"
author: "Ethan Cissell"
date: "1/10/2021"
---
#This is a cleaned up version of the workflow implemented in the Diel BCM data on the DNA reads.#

# **QUALITY CONTROL**
#First, we will trim the DNA reads to quality 25 and trim adapters, removing reads below 100bp length, using *TRIMGALORE*
#Trim Galore version 0.6.6
#Cutadapt version 1.18

```r
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D1_1 --paired Diel/DNA/raw_data/D1_1/D1_1_1.fq.gz Diel/DNA/raw_data/D1_1/D1_1_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D1_3 --paired Diel/DNA/raw_data/D1_3/D1_3_1.fq.gz Diel/DNA/raw_data/D1_3/D1_3_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D1_5 --paired Diel/DNA/raw_data/D1_5/D1_5_1.fq.gz Diel/DNA/raw_data/D1_5/D1_5_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D2_1 --paired Diel/DNA/raw_data/D2_1/D2_1_1.fq.gz Diel/DNA/raw_data/D2_1/D2_1_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D2_3 --paired Diel/DNA/raw_data/D2_3/D2_3_1.fq.gz Diel/DNA/raw_data/D2_3/D2_3_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D2_5 --paired Diel/DNA/raw_data/D2_5/D2_5_1.fq.gz Diel/DNA/raw_data/D2_5/D2_5_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D3_1 --paired Diel/DNA/raw_data/D3_1/D3_1_1.fq.gz Diel/DNA/raw_data/D3_1/D3_1_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D3_3 --paired Diel/DNA/raw_data/D3_3/D3_3_1.fq.gz Diel/DNA/raw_data/D3_3/D3_3_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D3_5 --paired Diel/DNA/raw_data/D3_5/D3_5_1.fq.gz Diel/DNA/raw_data/D3_5/D3_5_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D4_1 --paired Diel/DNA/raw_data/D4_1/D4_1_1.fq.gz Diel/DNA/raw_data/D4_1/D4_1_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D4_3 --paired Diel/DNA/raw_data/D4_3/D4_3_1.fq.gz Diel/DNA/raw_data/D4_3/D4_3_2.fq.gz &&
trim_galore -q 25 --gzip --length 100 -o Diel/DNA/raw_data/D4_5 --paired Diel/DNA/raw_data/D4_5/D4_5_1.fq.gz Diel/DNA/raw_data/D4_5/D4_5_2.fq.gz
```

#Now we will do a second pass trim to get any remaining adapters using the expanded adapter database in *BBDUK*

```r
bbduk.sh in1=Diel/DNA/raw_data/D1_1/D1_1_1_val_1.fq.gz in2=Diel/DNA/raw_data/D1_1/D1_1_2_val_2.fq.gz out1=Diel/DNA/raw_data/D1_1/D1_1_1_qc.fq.gz out2=Diel/DNA/raw_data/D1_1/D1_1_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D1_3/D1_3_1_val_1.fq.gz in2=Diel/DNA/raw_data/D1_3/D1_3_2_val_2.fq.gz out1=Diel/DNA/raw_data/D1_3/D1_3_1_qc.fq.gz out2=Diel/DNA/raw_data/D1_3/D1_3_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D1_5/D1_5_1_val_1.fq.gz in2=Diel/DNA/raw_data/D1_5/D1_5_2_val_2.fq.gz out1=Diel/DNA/raw_data/D1_5/D1_5_1_qc.fq.gz out2=Diel/DNA/raw_data/D1_5/D1_5_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D2_1/D2_1_1_val_1.fq.gz in2=Diel/DNA/raw_data/D2_1/D2_1_2_val_2.fq.gz out1=Diel/DNA/raw_data/D2_1/D2_1_1_qc.fq.gz out2=Diel/DNA/raw_data/D2_1/D2_1_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D2_3/D2_3_1_val_1.fq.gz in2=Diel/DNA/raw_data/D2_3/D2_3_2_val_2.fq.gz out1=Diel/DNA/raw_data/D2_3/D2_3_1_qc.fq.gz out2=Diel/DNA/raw_data/D2_3/D2_3_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D2_5/D2_5_1_val_1.fq.gz in2=Diel/DNA/raw_data/D2_5/D2_5_2_val_2.fq.gz out1=Diel/DNA/raw_data/D2_5/D2_5_1_qc.fq.gz out2=Diel/DNA/raw_data/D2_5/D2_5_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D3_1/D3_1_1_val_1.fq.gz in2=Diel/DNA/raw_data/D3_1/D3_1_2_val_2.fq.gz out1=Diel/DNA/raw_data/D3_1/D3_1_1_qc.fq.gz out2=Diel/DNA/raw_data/D3_1/D3_1_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D3_3/D3_3_1_val_1.fq.gz in2=Diel/DNA/raw_data/D3_3/D3_3_2_val_2.fq.gz out1=Diel/DNA/raw_data/D3_3/D3_3_1_qc.fq.gz out2=Diel/DNA/raw_data/D3_3/D3_3_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D3_5/D3_5_1_val_1.fq.gz in2=Diel/DNA/raw_data/D3_5/D3_5_2_val_2.fq.gz out1=Diel/DNA/raw_data/D3_5/D3_5_1_qc.fq.gz out2=Diel/DNA/raw_data/D3_5/D3_5_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D4_1/D4_1_1_val_1.fq.gz in2=Diel/DNA/raw_data/D4_1/D4_1_2_val_2.fq.gz out1=Diel/DNA/raw_data/D4_1/D4_1_1_qc.fq.gz out2=Diel/DNA/raw_data/D4_1/D4_1_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D4_3/D4_3_1_val_1.fq.gz in2=Diel/DNA/raw_data/D4_3/D4_3_2_val_2.fq.gz out1=Diel/DNA/raw_data/D4_3/D4_3_1_qc.fq.gz out2=Diel/DNA/raw_data/D4_3/D4_3_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo &&
bbduk.sh in1=Diel/DNA/raw_data/D4_5/D4_5_1_val_1.fq.gz in2=Diel/DNA/raw_data/D4_5/D4_5_2_val_2.fq.gz out1=Diel/DNA/raw_data/D4_5/D4_5_1_qc.fq.gz out2=Diel/DNA/raw_data/D4_5/D4_5_2_qc.fq.gz ref=bbmap/bbmap/adapters.fa ktrim=r k=23 tpe tbo
```

#Now we will remove Human DNA contamination using *Bowtie2*
#*HG38, patch release 13 (2019/02/28), GenBank Acession#: GCA_000001405.28*

```r
wget https://genome-idx.s3.amazonaws.com/bt/GRCh38_noalt_as.zip
unzip GRCh38_noalt_as.zip

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D1_1/D1_1_1_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_qc.fq.gz -S Diel/DNA/raw_data/D1_1/D1_1_mapped_and_unmapped.sam && samtools view -bS Diel/DNA/raw_data/D1_1/D1_1_mapped_and_unmapped.sam > Diel/DNA/raw_data/D1_1/D1_1_mapped_and_unmapped.bam &&
samtools view -b -f 12 -F 256 Diel/DNA/raw_data/D1_1/D1_1_mapped_and_unmapped.bam > Diel/DNA/raw_data/D1_1/D1_1_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 2 Diel/DNA/raw_data/D1_1/D1_1_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D1_1/D1_1_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D1_1/D1_1_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D1_1/D1_1_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D1_1/D1_1_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D1_1/*.sam &&
rm -r Diel/DNA/raw_data/D1_1/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D1_3/D1_3_1_qc.fq.gz -2 Diel/DNA/raw_data/D1_3/D1_3_2_qc.fq.gz -S Diel/DNA/raw_data/D1_3/D1_3_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D1_3/D1_3_mapped_and_unmapped.sam > Diel/DNA/raw_data/D1_3/D1_3_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D1_3/D1_3_mapped_and_unmapped.bam > Diel/DNA/raw_data/D1_3/D1_3_bothReadsUnmapped.bam &&
samtools sort -@ 8 -n -m 5G Diel/DNA/raw_data/D1_3/D1_3_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D1_3/D1_3_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D1_3/D1_3_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D1_3/D1_3_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D1_3/D1_3_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D1_3/*.sam &&
rm -r Diel/DNA/raw_data/D1_3/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D1_5/D1_5_1_qc.fq.gz -2 Diel/DNA/raw_data/D1_5/D1_5_2_qc.fq.gz -S Diel/DNA/raw_data/D1_5/D1_5_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D1_5/D1_5_mapped_and_unmapped.sam > Diel/DNA/raw_data/D1_5/D1_5_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D1_5/D1_5_mapped_and_unmapped.bam > Diel/DNA/raw_data/D1_5/D1_5_bothReadsUnmapped.bam &&
samtools sort -@ 8 -n -m 5G Diel/DNA/raw_data/D1_5/D1_5_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D1_5/D1_5_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D1_5/D1_5_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D1_5/D1_5_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D1_5/D1_5_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D1_5/*.sam &&
rm -r Diel/DNA/raw_data/D1_5/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D2_1/D2_1_1_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_qc.fq.gz -S Diel/DNA/raw_data/D2_1/D2_1_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D2_1/D2_1_mapped_and_unmapped.sam > Diel/DNA/raw_data/D2_1/D2_1_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D2_1/D2_1_mapped_and_unmapped.bam > Diel/DNA/raw_data/D2_1/D2_1_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D2_1/D2_1_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D2_1/D2_1_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D2_1/D2_1_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D2_1/D2_1_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D2_1/D2_1_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D2_1/*.sam &&
rm -r Diel/DNA/raw_data/D2_1/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D2_3/D2_3_1_qc.fq.gz -2 Diel/DNA/raw_data/D2_3/D2_3_2_qc.fq.gz -S Diel/DNA/raw_data/D2_3/D2_3_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D2_3/D2_3_mapped_and_unmapped.sam > Diel/DNA/raw_data/D2_3/D2_3_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D2_3/D2_3_mapped_and_unmapped.bam > Diel/DNA/raw_data/D2_3/D2_3_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D2_3/D2_3_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D2_3/D2_3_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D2_3/D2_3_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D2_3/D2_3_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D2_3/D2_3_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D2_3/*.sam &&
rm -r Diel/DNA/raw_data/D2_3/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D2_5/D2_5_1_qc.fq.gz -2 Diel/DNA/raw_data/D2_5/D2_5_2_qc.fq.gz -S Diel/DNA/raw_data/D2_5/D2_5_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D2_5/D2_5_mapped_and_unmapped.sam > Diel/DNA/raw_data/D2_5/D2_5_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D2_5/D2_5_mapped_and_unmapped.bam > Diel/DNA/raw_data/D2_5/D2_5_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D2_5/D2_5_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D2_5/D2_5_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D2_5/D2_5_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D2_5/D2_5_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D2_5/D2_5_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D2_5/*.sam &&
rm -r Diel/DNA/raw_data/D2_5/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D3_1/D3_1_1_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_qc.fq.gz -S Diel/DNA/raw_data/D3_1/D3_1_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D3_1/D3_1_mapped_and_unmapped.sam > Diel/DNA/raw_data/D3_1/D3_1_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D3_1/D3_1_mapped_and_unmapped.bam > Diel/DNA/raw_data/D3_1/D3_1_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D3_1/D3_1_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D3_1/D3_1_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D3_1/D3_1_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D3_1/D3_1_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D3_1/D3_1_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D3_1/*.sam &&
rm -r Diel/DNA/raw_data/D3_1/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D3_3/D3_3_1_qc.fq.gz -2 Diel/DNA/raw_data/D3_3/D3_3_2_qc.fq.gz -S Diel/DNA/raw_data/D3_3/D3_3_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D3_3/D3_3_mapped_and_unmapped.sam > Diel/DNA/raw_data/D3_3/D3_3_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D3_3/D3_3_mapped_and_unmapped.bam > Diel/DNA/raw_data/D3_3/D3_3_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D3_3/D3_3_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D3_3/D3_3_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D3_3/D3_3_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D3_3/D3_3_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D3_3/D3_3_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D3_3/*.sam &&
rm -r Diel/DNA/raw_data/D3_3/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D3_5/D3_5_1_qc.fq.gz -2 Diel/DNA/raw_data/D3_5/D3_5_2_qc.fq.gz -S Diel/DNA/raw_data/D3_5/D3_5_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D3_5/D3_5_mapped_and_unmapped.sam > Diel/DNA/raw_data/D3_5/D3_5_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D3_5/D3_5_mapped_and_unmapped.bam > Diel/DNA/raw_data/D3_5/D3_5_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D3_5/D3_5_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D3_5/D3_5_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D3_5/D3_5_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D3_5/D3_5_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D3_5/D3_5_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D3_5/*.sam &&
rm -r Diel/DNA/raw_data/D3_5/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D4_1/D4_1_1_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_qc.fq.gz -S Diel/DNA/raw_data/D4_1/D4_1_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D4_1/D4_1_mapped_and_unmapped.sam > Diel/DNA/raw_data/D4_1/D4_1_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D4_1/D4_1_mapped_and_unmapped.bam > Diel/DNA/raw_data/D4_1/D4_1_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D4_1/D4_1_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D4_1/D4_1_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D4_1/D4_1_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D4_1/D4_1_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D4_1/D4_1_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D4_1/*.sam &&
rm -r Diel/DNA/raw_data/D4_1/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D4_3/D4_3_1_qc.fq.gz -2 Diel/DNA/raw_data/D4_3/D4_3_2_qc.fq.gz -S Diel/DNA/raw_data/D4_3/D4_3_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D4_3/D4_3_mapped_and_unmapped.sam > Diel/DNA/raw_data/D4_3/D4_3_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D4_3/D4_3_mapped_and_unmapped.bam > Diel/DNA/raw_data/D4_3/D4_3_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D4_3/D4_3_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D4_3/D4_3_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D4_3/D4_3_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D4_3/D4_3_1_final_qc.fastq.gz \
    -2 Diel/DNA/raw_data/D4_3/D4_3_2_final_qc.fastq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D4_3/*.sam &&
rm -r Diel/DNA/raw_data/D4_3/*.bam &&

bowtie2 -p 8 -x GRCh38_noalt_as -1 Diel/DNA/raw_data/D4_5/D4_5_1_qc.fq.gz -2 Diel/DNA/raw_data/D4_5/D4_5_2_qc.fq.gz -S Diel/DNA/raw_data/D4_5/D4_5_mapped_and_unmapped.sam && samtools view -@ 8 -bS Diel/DNA/raw_data/D4_5/D4_5_mapped_and_unmapped.sam > Diel/DNA/raw_data/D4_5/D4_5_mapped_and_unmapped.bam &&
samtools view -@ 8 -b -f 12 -F 256 Diel/DNA/raw_data/D4_5/D4_5_mapped_and_unmapped.bam > Diel/DNA/raw_data/D4_5/D4_5_bothReadsUnmapped.bam &&
samtools sort -n -m 5G -@ 8 Diel/DNA/raw_data/D4_5/D4_5_bothReadsUnmapped.bam -o Diel/DNA/raw_data/D4_5/D4_5_bothReadsUnmapped_sorted.bam &&
samtools fastq -@ 8 Diel/DNA/raw_data/D4_5/D4_5_bothReadsUnmapped_sorted.bam \
    -1 Diel/DNA/raw_data/D4_5/D4_5_1_final_qc.fq.gz \
    -2 Diel/DNA/raw_data/D4_5/D4_5_2_final_qc.fq.gz \
    -0 /dev/null -s /dev/null -n &&
rm -r Diel/DNA/raw_data/D4_5/*.sam &&
rm -r Diel/DNA/raw_data/D4_5/*.bam &&
```
#Now we will perform one final hard length filtering at 100bp using bbduk just to make sure we remove all short reads.

```r
bbduk.sh in1=Diel/DNA/raw_data/D1_1/D1_1_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D1_1/D1_1_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D1_3/D1_3_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D1_3/D1_3_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D1_5/D1_5_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D1_5/D1_5_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D2_1/D2_1_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D2_1/D2_1_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D2_3/D2_3_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D2_3/D2_3_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D2_5/D2_5_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D2_5/D2_5_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D3_1/D3_1_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D3_1/D3_1_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D3_3/D3_3_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D3_3/D3_3_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D3_5/D3_5_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D3_5/D3_5_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D4_1/D4_1_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D4_1/D4_1_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D4_3/D4_3_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D4_3/D4_3_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz minlen=100 &&
bbduk.sh in1=Diel/DNA/raw_data/D4_5/D4_5_1_final_qc.fq.gz in2=Diel/DNA/raw_data/D4_5/D4_5_2_final_qc.fq.gz out1=Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz out2=Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz minlen=100
```

#Now we will look at our quality using FASTQC

```r
fastqc Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -t 8 &&
fastqc Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -t 8
```

#Now we will use Nonpareil 3 version 3.304 to look at coverage and diversity

```r
pigz -d Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D1_1/nonparD1_1 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D1_3/nonparD1_3 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D1_5/nonparD1_5 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D2_1/nonparD2_1 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D2_3/nonparD2_3 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D2_5/nonparD2_5 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D3_1/nonparD3_1 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D3_3/nonparD3_3 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D3_5/nonparD3_5 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D4_1/nonparD4_1 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D4_3/nonparD4_3 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq -p 8 &&

pigz -d Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -p 8 &&
nonpareil -s Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq -T kmer -f fastq -b Diel/DNA/raw_data/D4_5/nonparD4_5 -X 10000 -t 8 -n 1024 -k 31 -R 2048 &&
pigz Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq -p 8
```

#Lets plot the Nonpareil models in R
```r
##Load in required packages
library(Nonpareil)

#GENERATE MODEL D1_1
npD1_1=Nonpareil.curve("/Users/cissell/Desktop/D1_1.npo", col = "#440154FF")
#OBTAIN PARAMETER ESTIMATES
print(npD1_1)
#Check Model Summary
npD1_1

#GENERATE MODEL D1_3
npD1_3=Nonpareil.curve ("/Users/cissell/Desktop/D1_3.npo", col = "#482677FF")
#OBTAIN PARAMETER ESTIMATES
print(npD1_3)
#Check Model Summary
npD1_3

#GENERATE MODEL D1_5
npD1_5=Nonpareil.curve ("/Users/cissell/Desktop/D1_5.npo", col = "#404788FF")
#OBTAIN PARAMETER ESTIMATES
print(npD1_5)
#Check Model Summary
npD1_5

#GENERATE MODEL D2_1
npD2_1=Nonpareil.curve ("/Users/cissell/Desktop/D2_1.npo", col = "#33638DFF")
#OBTAIN PARAMETER ESTIMATES
print(npD2_1)
#Check Model Summary
npD2_1

#GENERATE MODEL D2_3
npD2_3=Nonpareil.curve ("/Users/cissell/Desktop/D2_3.npo", col = "#287D8EFF")
#OBTAIN PARAMETER ESTIMATES
print(npD2_3)
#Check Model Summary
npD2_3

#GENERATE MODEL D2_5
npD2_5=Nonpareil.curve ("/Users/cissell/Desktop/D2_5.npo", col = "#1F968BFF")
#OBTAIN PARAMETER ESTIMATES
print(npD2_5)
#Check Model Summary
npD2_5

#GENERATE MODEL D3_1
npD3_1=Nonpareil.curve ("/Users/cissell/Desktop/D3_1.npo", col = "#29AF7FFF")
#OBTAIN PARAMETER ESTIMATES
print(npD3_1)
#Check Model Summary
npD3_1

#GENERATE MODEL D3_3
npD3_3=Nonpareil.curve ("/Users/cissell/Desktop/D3_3.npo", col = "#55C667FF")
#OBTAIN PARAMETER ESTIMATES
print(npD3_3)
#Check Model Summary
npD3_3

#GENERATE MODEL D3_5
npD3_5=Nonpareil.curve ("/Users/cissell/Desktop/D3_5.npo", col = "#95D840FF")
#OBTAIN PARAMETER ESTIMATES
print(npD3_5)
#Check Model Summary
npD3_5

#GENERATE MODEL D4_1
npD4_1=Nonpareil.curve ("/Users/cissell/Desktop/D4_1.npo", col = "#B8DE29FF")
#OBTAIN PARAMETER ESTIMATES
print(npD4_1)
#Check Model Summary
npD4_1

#GENERATE MODEL D4_3
npD4_3=Nonpareil.curve ("/Users/cissell/Desktop/D4_3.npo", col = "#DCE319FF")
#OBTAIN PARAMETER ESTIMATES
print(npD4_3)
#Check Model Summary
npD4_3

#GENERATE MODEL D4_5
npD4_5=Nonpareil.curve ("/Users/cissell/Desktop/D4_5.npo", col = "#FDE725FF")
#OBTAIN PARAMETER ESTIMATES
print(npD4_5)
#Check Model Summary
npD4_5
```
```r
#Make list for legend
np_list=list(npD1_1, npD1_3, npD1_5, npD2_1, npD2_3, npD2_5, npD3_1, npD3_3, npD3_5, npD4_1, npD4_3, npD4_5)
```
```r
#GENERATE COMBINED PLOT OF MODEL OUTPUTS
plot(npD1_1, col="#440154FF",plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5,main='',xlim=c(1e7,1e13))
plot(npD1_3, col="#482677FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD1_5, col="#404788FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD2_1, col="#33638DFF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD2_3, col="#287D8EFFF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD2_5, col="#1F968BFF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD3_1, col="#29AF7FFF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD3_3, col="#55C667FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD3_5, col="#95D840FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD4_1, col="#B8DE29FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD4_3, col="#DCE319FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
plot(npD4_5, col="#FDE725FF",add=TRUE, plot.observed=FALSE,plot.model=TRUE,plot.diversity=FALSE,las=1,model.lwd=5, main='')
Nonpareil.legend(np_list,x=1e11,cex=0.85,bty="n", y=0.6)

dev.print(png,fil="DNA_nonpar.png",type="quartz",antialias="default",width=6.5,
          height=6.5,units="in",res=1300)
```
# **ASSEMBLY-FREE TAXONOMIC PROFILING**
#This analysis will use both a read-based and assembly-based approach to characterize these samples. Read-based approaches avoid assembly biases, and therefore will be used for coarse tracking of taxonomy across time and space.

#Assembly-based approaches will be used to look at genome-resolved functional contributions through time and space. Growth rates for dominant taxa will be tracked through time from genomes, too.

#Let's start with the read based for tracking broad taxonomy through time. We will first use kaiju v 1.7.4 with the NCBI nr+euk database updated 2020-05-25
```r
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D1_1/kaiju_D1_1 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D1_3/kaiju_D1_3 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D1_5/kaiju_D1_5 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D2_1/kaiju_D2_1 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D2_3/kaiju_D2_3 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D2_5/kaiju_D2_5 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D3_1/kaiju_D3_1 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D3_3/kaiju_D3_3 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D3_5/kaiju_D3_5 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D4_1/kaiju_D4_1 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D4_3/kaiju_D4_3 -z 25 -e 5 &&
kaiju -t kaiju_db/nodes.dmp -f kaiju_db/kaiju_db_nr_euk.fmi -i Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -j Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -o Diel/DNA/raw_data/D4_5/kaiju_D4_5 -z 25 -e 5
```

#Now we need to create summary tables of the classification to import into R
```r
kaiju2table -t kaiju_db/nodes.dmp -n kaiju_db/names.dmp -r order -m 0.1 -u -l superkingdom,phylum,class,order -o kaiju_summary.tsv Diel/DNA/raw_data/D1_1/kaiju_D1_1 Diel/DNA/raw_data/D1_3/kaiju_D1_3 Diel/DNA/raw_data/D1_5/kaiju_D1_5 Diel/DNA/raw_data/D2_1/kaiju_D2_1 Diel/DNA/raw_data/D2_3/kaiju_D2_3 Diel/DNA/raw_data/D2_5/kaiju_D2_5 Diel/DNA/raw_data/D3_1/kaiju_D3_1 Diel/DNA/raw_data/D3_3/kaiju_D3_3 Diel/DNA/raw_data/D3_5/kaiju_D3_5 Diel/DNA/raw_data/D4_1/kaiju_D4_1 Diel/DNA/raw_data/D4_3/kaiju_D4_3 Diel/DNA/raw_data/D4_5/kaiju_D4_5
```
#Now we need to create another summary table of the classification to import into R for phylum level
```r
kaiju2table -t kaiju_db/nodes.dmp -n kaiju_db/names.dmp -r phylum -m 0.1 -u -l superkingdom,phylum -o kaiju_summary_phyla.tsv Diel/DNA/raw_data/D1_1/kaiju_D1_1 Diel/DNA/raw_data/D1_3/kaiju_D1_3 Diel/DNA/raw_data/D1_5/kaiju_D1_5 Diel/DNA/raw_data/D2_1/kaiju_D2_1 Diel/DNA/raw_data/D2_3/kaiju_D2_3 Diel/DNA/raw_data/D2_5/kaiju_D2_5 Diel/DNA/raw_data/D3_1/kaiju_D3_1 Diel/DNA/raw_data/D3_3/kaiju_D3_3 Diel/DNA/raw_data/D3_5/kaiju_D3_5 Diel/DNA/raw_data/D4_1/kaiju_D4_1 Diel/DNA/raw_data/D4_3/kaiju_D4_3 Diel/DNA/raw_data/D4_5/kaiju_D4_5
```
# **ASSEMBLY**
#Time to assemble using metaSPAdes **version 3.14.1**

```r
metaspades.py -o Diel/DNA/raw_data/D1_1 -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -t 35 -m 500 --meta -k 21,35,55,77,99 &&
```
#Fails because not enough memory on server. We will use MEGAHIT v. 1.2.9 for this dataset then. Oh well. I would reccomed trying METASPAdes on a dataset prior to MEGAHIT.

#MEGAHIT ver. 1.2.9 COASSEMBLY within individual mat identity (within mat coassemble)

```r
megahit -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fastq,Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz,Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz,Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz,Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -o MEGAHIT/D1/ --presets meta-large -m 0.9 -t 36 --min-contig-len 1500 &&
megahit -1 Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz,Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz,Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz,Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz,Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -o MEGAHIT/D2/ --presets meta-large -m 0.9 -t 36 --min-contig-len 1500 &&
megahit -1 Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz,Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz,Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz,Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz,Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -o MEGAHIT/D3/ --presets meta-large -m 0.9 -t 36 --min-contig-len 1500 &&
megahit -1 Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz,Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz,Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz,Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz,Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -o MEGAHIT/D4/ --presets meta-large -m 0.9 -t 36 --min-contig-len 1500
```
#Let's get the assembly stats real quick. We will use QUAST ver 5.0.2
#QUAST for coassembly
```r
quast -o MEGAHIT/D1/QUAST/ -t 10 MEGAHIT/D1/final.contigs.fa &&
quast -o MEGAHIT/D2/QUAST/ -t 10 MEGAHIT/D2/final.contigs.fa &&
quast -o MEGAHIT/D3/QUAST/ -t 10 MEGAHIT/D3/final.contigs.fa &&
quast -o MEGAHIT/D4/QUAST/ -t 10 MEGAHIT/D4/final.contigs.fa &&
```

#Simplify deflines on FASTA (for Anvio later) using custom sed scripts
```r
sed '/^>/s/ .*//' MEGAHIT/D1/final.contigs.fa > MEGAHIT/D1/simple_final.contigs.fa &&
sed -i 's/k127/D1/g' MEGAHIT/D1/simple_final.contigs.fa &&
sed '/^>/s/ .*//' MEGAHIT/D2/final.contigs.fa > MEGAHIT/D2/simple_final.contigs.fa &&
sed -i 's/k127/D2/g' MEGAHIT/D2/simple_final.contigs.fa &&
sed '/^>/s/ .*//' MEGAHIT/D3/final.contigs.fa > MEGAHIT/D3/simple_final.contigs.fa &&
sed -i 's/k127/D3/g' MEGAHIT/D3/simple_final.contigs.fa &&
sed '/^>/s/ .*//' MEGAHIT/D4/final.contigs.fa > MEGAHIT/D4/simple_final.contigs.fa &&
sed -i 's/k127/D4/g' MEGAHIT/D4/simple_final.contigs.fa
```
#KAT for further assembly quality check
```r
kat comp -t 26 -o D1_1_vs_coassemble 'Diel/DNA/raw_data/D1_1/*.fq.gz' MEGAHIT/D1/final.contigs.fa &&
kat plot spectra-cn D1_1_vs_coassemble-main.mx -o D1_1.png -y 900000 -x 150 &&
kat comp -t 26 -o D1_3_vs_coassemble 'Diel/DNA/raw_data/D1_3/*.fq.gz' MEGAHIT/D1/final.contigs.fa &&
kat plot spectra-cn D1_3_vs_coassemble-main.mx -o D1_3.png -y 900000 -x 150 &&
kat comp -t 26 -o D1_5_vs_coassemble 'Diel/DNA/raw_data/D1_5/*.fq.gz' MEGAHIT/D1/final.contigs.fa &&
kat plot spectra-cn D1_5_vs_coassemble-main.mx -o D1_5.png -y 900000 -x 150 &&
kat comp -t 26 -o D2_1_vs_coassemble 'Diel/DNA/raw_data/D2_1/*.fq.gz' MEGAHIT/D2/final.contigs.fa &&
kat plot spectra-cn D2_1_vs_coassemble-main.mx -o D2_1.png -y 900000 -x 150 &&
kat comp -t 26 -o D2_3_vs_coassemble 'Diel/DNA/raw_data/D2_3/*.fq.gz' MEGAHIT/D2/final.contigs.fa &&
kat plot spectra-cn D2_3_vs_coassemble-main.mx -o D2_3.png -y 900000 -x 150 &&
kat comp -t 26 -o D2_5_vs_coassemble 'Diel/DNA/raw_data/D2_5/*.fq.gz' MEGAHIT/D2/final.contigs.fa &&
kat plot spectra-cn D2_5_vs_coassemble-main.mx -o D2_5.png -y 900000 -x 150 &&
kat comp -t 26 -o D3_1_vs_coassemble 'Diel/DNA/raw_data/D3_1/*.fq.gz' MEGAHIT/D3/final.contigs.fa &&
kat plot spectra-cn D3_1_vs_coassemble-main.mx -o D3_1.png -y 900000 -x 150 &&
kat comp -t 26 -o D3_3_vs_coassemble 'Diel/DNA/raw_data/D3_3/*.fq.gz' MEGAHIT/D3/final.contigs.fa &&
kat plot spectra-cn D3_3_vs_coassemble-main.mx -o D3_3.png -y 900000 -x 150 &&
kat comp -t 26 -o D3_5_vs_coassemble 'Diel/DNA/raw_data/D3_5/*.fq.gz' MEGAHIT/D3/final.contigs.fa &&
kat plot spectra-cn D3_5_vs_coassemble-main.mx -o D3_5.png -y 900000 -x 150 &&
kat comp -t 26 -o D4_1_vs_coassemble 'Diel/DNA/raw_data/D4_1/*.fq.gz' MEGAHIT/D4/final.contigs.fa &&
kat plot spectra-cn D4_1_vs_coassemble-main.mx -o D4_1.png -y 900000 -x 150 &&
kat comp -t 26 -o D4_3_vs_coassemble 'Diel/DNA/raw_data/D4_3/*.fq.gz' MEGAHIT/D4/final.contigs.fa &&
kat plot spectra-cn D4_3_vs_coassemble-main.mx -o D4_3.png -y 900000 -x 150 &&
kat comp -t 26 -o D4_5_vs_coassemble 'Diel/DNA/raw_data/D4_5/*.fq.gz' MEGAHIT/D4/final.contigs.fa &&
kat plot spectra-cn D4_5_vs_coassemble-main.mx -o D4_5.png -y 900000 -x 150 &&
```

# **BINNING**
#COAASEMBLY - We will now start mapping reads to the coassembly to use in binning and coverage calc. We will be using Bowtie2 and Samtools. I had to adjust # threads on some lines because of memory restrictions.
```r
bowtie2-build --threads 32 MEGAHIT/D1/simple_final.contigs.fa D1 &&
bowtie2 -x D1 -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -S MEGAHIT/D1/D1_1.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/D1_1.sam > MEGAHIT/D1/D1_1.bam -@ 32 &&
samtools sort MEGAHIT/D1/D1_1.bam -o MEGAHIT/D1/D1_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/D1_1_sort.bam -@ 32 &&
rm MEGAHIT/D1/D1_1.sam &&
rm MEGAHIT/D1/D1_1.bam &&
pigz MEGAHIT/D1/D1_1_sort.bam -p 32 &&
bowtie2 -x D1 -1 Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -S MEGAHIT/D1/D1_3.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/D1_3.sam > MEGAHIT/D1/D1_3.bam -@ 32 &&
samtools sort MEGAHIT/D1/D1_3.bam -o MEGAHIT/D1/D1_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/D1_3_sort.bam -@ 32 &&
rm MEGAHIT/D1/D1_3.sam &&
rm MEGAHIT/D1/D1_3.bam &&
pigz MEGAHIT/D1/D1_3_sort.bam -p 32 &&
bowtie2 -x D1 -1 Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -S MEGAHIT/D1/D1_5.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/D1_5.sam > MEGAHIT/D1/D1_5.bam -@ 32 &&
samtools sort MEGAHIT/D1/D1_5.bam -o MEGAHIT/D1/D1_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/D1_5_sort.bam -@ 32 &&
rm MEGAHIT/D1/D1_5.sam &&
rm MEGAHIT/D1/D1_5.bam &&
rm -r D1*.bt2 &&
pigz MEGAHIT/D1/D1_5_sort.bam -p 32 &&
bowtie2-build --threads 32 MEGAHIT/D2/simple_final.contigs.fa D2 &&
bowtie2 -x D2 -1 Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -S MEGAHIT/D2/D2_1.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/D2_1.sam > MEGAHIT/D2/D2_1.bam -@ 32 &&
samtools sort MEGAHIT/D2/D2_1.bam -o MEGAHIT/D2/D2_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/D2_1_sort.bam -@ 32 &&
rm MEGAHIT/D2/D2_1.sam &&
rm MEGAHIT/D2/D2_1.bam &&
pigz MEGAHIT/D2/D2_1_sort.bam -p 32 &&
bowtie2 -x D2 -1 Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -S MEGAHIT/D2/D2_3.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/D2_3.sam > MEGAHIT/D2/D2_3.bam -@ 32 &&
samtools sort MEGAHIT/D2/D2_3.bam -o MEGAHIT/D2/D2_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/D2_3_sort.bam -@ 32 &&
rm MEGAHIT/D2/D2_3.sam &&
rm MEGAHIT/D2/D2_3.bam &&
pigz MEGAHIT/D2/D2_3_sort.bam -p 32 &&
bowtie2 -x D2 -1 Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -S MEGAHIT/D2/D2_5.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/D2_5.sam > MEGAHIT/D2/D2_5.bam -@ 32 &&
samtools sort MEGAHIT/D2/D2_5.bam -o MEGAHIT/D2/D2_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/D2_5_sort.bam -@ 32 &&
rm MEGAHIT/D2/D2_5.sam &&
rm MEGAHIT/D2/D2_5.bam &&
rm -r D2*.bt2 &&
pigz MEGAHIT/D2/D2_5_sort.bam -p 32 &&
bowtie2-build --threads 32 MEGAHIT/D3/simple_final.contigs.fa D3 &&
bowtie2 -x D3 -1 Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -S MEGAHIT/D3/D3_1.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/D3_1.sam > MEGAHIT/D3/D3_1.bam -@ 32 &&
samtools sort MEGAHIT/D3/D3_1.bam -o MEGAHIT/D3/D3_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/D3_1_sort.bam -@ 32 &&
rm MEGAHIT/D3/D3_1.sam &&
rm MEGAHIT/D3/D3_1.bam &&
pigz MEGAHIT/D3/D3_1_sort.bam -p 32 &&
bowtie2 -x D3 -1 Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -S MEGAHIT/D3/D3_3.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/D3_3.sam > MEGAHIT/D3/D3_3.bam -@ 32 &&
samtools sort MEGAHIT/D3/D3_3.bam -o MEGAHIT/D3/D3_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/D3_3_sort.bam -@ 32 &&
rm MEGAHIT/D3/D3_3.sam &&
rm MEGAHIT/D3/D3_3.bam &&
pigz MEGAHIT/D3/D3_3_sort.bam -p 32 &&
bowtie2 -x D3 -1 Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -S MEGAHIT/D3/D3_5.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/D3_5.sam > MEGAHIT/D3/D3_5.bam -@ 32 &&
samtools sort MEGAHIT/D3/D3_5.bam -o MEGAHIT/D3/D3_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/D3_5_sort.bam -@ 32 &&
rm MEGAHIT/D3/D3_5.sam &&
rm MEGAHIT/D3/D3_5.bam &&
rm -r D3*.bt2 &&
pigz MEGAHIT/D3/D3_5_sort.bam -p 32 &&
bowtie2-build --threads 32 MEGAHIT/D4/simple_final.contigs.fa D4 &&
bowtie2 -x D4 -1 Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -S MEGAHIT/D4/D4_1.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/D4_1.sam > MEGAHIT/D4/D4_1.bam -@ 32 &&
samtools sort MEGAHIT/D4/D4_1.bam -o MEGAHIT/D4/D4_1_sort.bam -@ 16 &&
samtools index MEGAHIT/D4/D4_1_sort.bam -@ 16 &&
rm MEGAHIT/D4/D4_1.sam &&
rm MEGAHIT/D4/D4_1.bam &&
pigz MEGAHIT/D4/D4_1_sort.bam -p 32 &&
bowtie2 -x D4 -1 Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -S MEGAHIT/D4/D4_3.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/D4_3.sam > MEGAHIT/D4/D4_3.bam -@ 32 &&
samtools sort MEGAHIT/D4/D4_3.bam -o MEGAHIT/D4/D4_3_sort.bam -@ 5 &&
samtools index MEGAHIT/D4/D4_3_sort.bam -@ 16 &&
rm MEGAHIT/D4/D4_3.sam &&
rm MEGAHIT/D4/D4_3.bam &&
pigz MEGAHIT/D4/D4_3_sort.bam -p 32 &&
bowtie2 -x D4 -1 Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -S MEGAHIT/D4/D4_5.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/D4_5.sam > MEGAHIT/D4/D4_5.bam -@ 32 &&
samtools sort MEGAHIT/D4/D4_5.bam -o MEGAHIT/D4/D4_5_sort.bam -@ 5 &&
samtools index MEGAHIT/D4/D4_5_sort.bam -@ 16 &&
rm MEGAHIT/D4/D4_5.sam &&
rm MEGAHIT/D4/D4_5.bam &&
rm -r D4*.bt2 &&
pigz MEGAHIT/D4/D4_5_sort.bam -p 32
```

#We will bin with 3 different automated binning algorithms, and then combine them into a nonredundant concensus set. This will be later followed by manual curation

#COASSEMBLY Metabat2 ver 2.15 for coassembly
```r
mkdir MEGAHIT/D1/METABAT
mkdir MEGAHIT/D2/METABAT
mkdir MEGAHIT/D3/METABAT
mkdir MEGAHIT/D4/METABAT
pigz -d MEGAHIT/D1/*.bam.gz -p 3 &&
jgi_summarize_bam_contig_depths --outputDepth MEGAHIT/D1/METABAT/D1_depth.txt MEGAHIT/D1/*.bam &&
pigz -p 30 MEGAHIT/D1/*.bam &&
pigz -d MEGAHIT/D2/*.bam.gz -p 30 &&
jgi_summarize_bam_contig_depths --outputDepth MEGAHIT/D2/METABAT/D2_depth.txt MEGAHIT/D2/*.bam &&
pigz -p 30 MEGAHIT/D2/*.bam &&
pigz -d MEGAHIT/D3/*.bam.gz -p 30 &&
jgi_summarize_bam_contig_depths --outputDepth MEGAHIT/D3/METABAT/D3_depth.txt MEGAHIT/D3/*.bam &&
pigz -p 30 MEGAHIT/D3/*.bam &&
pigz -d MEGAHIT/D4/*.bam.gz -p 30 &&
jgi_summarize_bam_contig_depths --outputDepth MEGAHIT/D4/METABAT/D4_depth.txt MEGAHIT/D4/*.bam &&
pigz -p 30 MEGAHIT/D4/*.bam &&
metabat2 -m 1500 -v -t 30 -i MEGAHIT/D1/simple_final.contigs.fa -a MEGAHIT/D1/METABAT/D1_depth.txt -o MEGAHIT/D1/METABAT/D1_metabat &&
metabat2 -m 1500 -v -t 30 -i MEGAHIT/D2/simple_final.contigs.fa -a MEGAHIT/D2/METABAT/D2_depth.txt -o MEGAHIT/D2/METABAT/D2_metabat &&
metabat2 -m 1500 -v -t 30 -i MEGAHIT/D3/simple_final.contigs.fa -a MEGAHIT/D3/METABAT/D3_depth.txt -o MEGAHIT/D3/METABAT/D3_metabat &&
metabat2 -m 1500 -v -t 30 -i MEGAHIT/D4/simple_final.contigs.fa -a MEGAHIT/D4/METABAT/D4_depth.txt -o MEGAHIT/D4/METABAT/D4_metabat
```

#COASSEMBLY Now we will bin with Maxbin2 ver. 2.2.7 for coassembly
```r
mkdir MEGAHIT/D1/MAXBIN &&
run_MaxBin.pl -min_contig_length 1500 -thread 32 -contig MEGAHIT/D1/simple_final.contigs.fa -out MEGAHIT/D1/MAXBIN -abund MEGAHIT/D1/METABAT/D1_depth.txt &&
mkdir MEGAHIT/D2/MAXBIN &&
run_MaxBin.pl -min_contig_length 1500 -thread 32 -contig MEGAHIT/D2/simple_final.contigs.fa -out MEGAHIT/D2/MAXBIN -abund MEGAHIT/D2/METABAT/D2_depth.txt &&
mkdir MEGAHIT/D3/MAXBIN &&
run_MaxBin.pl -min_contig_length 1500 -thread 32 -contig MEGAHIT/D3/simple_final.contigs.fa -out MEGAHIT/D3/MAXBIN -abund MEGAHIT/D3/METABAT/D3_depth.txt &&
mkdir MEGAHIT/D4/MAXBIN &&
run_MaxBin.pl -min_contig_length 1500 -thread 32 -contig MEGAHIT/D4/simple_final.contigs.fa -out MEGAHIT/D4/MAXBIN -abund MEGAHIT/D4/METABAT/D4_depth.txt
```

#COASSEMBLY Binning with Vamb
```r
vamb --outdir MEGAHIT/D1/VAMB --fasta MEGAHIT/D1/simple_final.contigs.fa --jgi MEGAHIT/D1/METABAT/D1_depth.txt --minfasta 200000 &&
vamb --outdir MEGAHIT/D2/VAMB --fasta MEGAHIT/D2/simple_final.contigs.fa --jgi MEGAHIT/D2/METABAT/D2_depth.txt --minfasta 200000 &&
vamb --outdir MEGAHIT/D3/VAMB --fasta MEGAHIT/D3/simple_final.contigs.fa --jgi MEGAHIT/D3/METABAT/D3_depth.txt --minfasta 200000 &&
vamb --outdir MEGAHIT/D4/VAMB --fasta MEGAHIT/D4/simple_final.contigs.fa --jgi MEGAHIT/D4/METABAT/D4_depth.txt --minfasta 200000
```

#COASSEMBLY  We will obtain a concensus bin set with DAS_Tool. First we have to convert the output of the bins to a format that DASTool likes.
```r
mkdir MEGAHIT/D1/DASTOOL/ &&
Fasta_to_Scaffolds2Bin.sh -e fasta -i MEGAHIT/D1/MAXBIN/ > MEGAHIT/D1/DASTOOL/maxbin2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fa -i MEGAHIT/D1/METABAT/ > MEGAHIT/D1/DASTOOL/metabat2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fna -i MEGAHIT/D1/VAMB/bins > MEGAHIT/D1/DASTOOL/vamb2bin.tsv &&
mkdir MEGAHIT/D2/DASTOOL/ &&
Fasta_to_Scaffolds2Bin.sh -e fasta -i MEGAHIT/D2/MAXBIN/ > MEGAHIT/D2/DASTOOL/maxbin2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fa -i MEGAHIT/D2/METABAT/ > MEGAHIT/D2/DASTOOL/metabat2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fna -i MEGAHIT/D2/VAMB/bins > MEGAHIT/D2/DASTOOL/vamb2bin.tsv &&
mkdir MEGAHIT/D3/DASTOOL/ &&
Fasta_to_Scaffolds2Bin.sh -e fasta -i MEGAHIT/D3/MAXBIN/ > MEGAHIT/D3/DASTOOL/maxbin2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fa -i MEGAHIT/D3/METABAT/ > MEGAHIT/D3/DASTOOL/metabat2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fna -i MEGAHIT/D3/VAMB/bins > MEGAHIT/D3/DASTOOL/vamb2bin.tsv &&
mkdir MEGAHIT/D4/DASTOOL/ &&
Fasta_to_Scaffolds2Bin.sh -e fasta -i MEGAHIT/D4/MAXBIN/ > MEGAHIT/D4/DASTOOL/maxbin2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fa -i MEGAHIT/D4/METABAT/ > MEGAHIT/D4/DASTOOL/metabat2bin.tsv &&
Fasta_to_Scaffolds2Bin.sh -e fna -i MEGAHIT/D4/VAMB/bins > MEGAHIT/D4/DASTOOL/vamb2bin.tsv
```
#Rename VAMB output (navigate [cd] to vamb bins for each assembly and run)
```r
for i in *; do mv "$i" VAMB_"$i"; done
```

#COASSEMBLY Now run DASTool
```r
DAS_Tool -i MEGAHIT/D1/DASTOOL/metabat2bin.tsv,MEGAHIT/D1/DASTOOL/maxbin2bin.tsv,MEGAHIT/D1/DASTOOL/vamb2bin.tsv -l metabat,maxbin,vamb -c MEGAHIT/D1/simple_final.contigs.fa -o MEGAHIT/D1/DASTOOL/D1 --threads 40 --search_engine diamond --write_bins --write_unbinned &&
DAS_Tool -i MEGAHIT/D2/DASTOOL/metabat2bin.tsv,MEGAHIT/D2/DASTOOL/maxbin2bin.tsv,MEGAHIT/D2/DASTOOL/vamb2bin.tsv -l metabat,maxbin,vamb -c MEGAHIT/D2/simple_final.contigs.fa -o MEGAHIT/D2/DASTOOL/D2 --threads 40 --search_engine diamond --write_bins --write_unbinned &&
DAS_Tool -i MEGAHIT/D3/DASTOOL/metabat2bin.tsv,MEGAHIT/D3/DASTOOL/maxbin2bin.tsv,MEGAHIT/D3/DASTOOL/vamb2bin.tsv -l metabat,maxbin,vamb -c MEGAHIT/D3/simple_final.contigs.fa -o MEGAHIT/D3/DASTOOL/D3 --threads 40 --search_engine diamond --write_bins --write_unbinned &&
DAS_Tool -i MEGAHIT/D4/DASTOOL/metabat2bin.tsv,MEGAHIT/D4/DASTOOL/maxbin2bin.tsv,MEGAHIT/D4/DASTOOL/vamb2bin.tsv -l metabat,maxbin,vamb -c MEGAHIT/D4/simple_final.contigs.fa -o MEGAHIT/D4/DASTOOL/D4 --threads 40 --search_engine diamond --write_bins --write_unbinned
```

#COASSEMBLY CheckM to assess completeness and contamination, as well as coarse lineage
```r
checkm lineage_wf -t 30 -x fa MEGAHIT/D1/DASTOOL/D1_dastool_DASTool_bins/ MEGAHIT/D1/CHECKM --file MEGAHIT/D1/CHECKM/D1_results.tsv &&
checkm lineage_wf -t 30 -x fa MEGAHIT/D2/DASTOOL/D2_dastool_DASTool_bins/ MEGAHIT/D2/CHECKM --file MEGAHIT/D2/CHECKM/D2_results.tsv &&
checkm lineage_wf -t 30 -x fa MEGAHIT/D3/DASTOOL/D3_dastool_DASTool_bins/ MEGAHIT/D3/CHECKM --file MEGAHIT/D3/CHECKM/D3_results.tsv &&
checkm lineage_wf -t 30 -x fa MEGAHIT/D4/DASTOOL/D4_dastool_DASTool_bins/ MEGAHIT/D4/CHECKM --file MEGAHIT/D4/CHECKM/D4_results.tsv
```
# BIN REFINEMENT
#ANVIO for manual curation of bins.

#Step One: Generate Contig Database
```r
anvi-gen-contigs-database -f MEGAHIT/D1/simple_final.contigs.fa -o MEGAHIT/D1/contigs.db -n 'D1 coassembly contigs database' --num-threads 32 &&
anvi-gen-contigs-database -f MEGAHIT/D2/simple_final.contigs.fa -o MEGAHIT/D2/contigs.db -n 'D2 coassembly contigs database' --num-threads 32 &&
anvi-gen-contigs-database -f MEGAHIT/D3/simple_final.contigs.fa -o MEGAHIT/D3/contigs.db -n 'D3 coassembly contigs database' --num-threads 32 &&
anvi-gen-contigs-database -f MEGAHIT/D4/simple_final.contigs.fa -o MEGAHIT/D4/contigs.db -n 'D4 coassembly contigs database' --num-threads 32 &&
anvi-run-hmms -c MEGAHIT/D1/contigs.db -T 40 &&
anvi-run-hmms -c MEGAHIT/D2/contigs.db -T 40 &&
anvi-run-hmms -c MEGAHIT/D3/contigs.db -T 40 &&
anvi-run-hmms -c MEGAHIT/D4/contigs.db -T 40
```
#Step Two: Create Profile Databases for each BAM file separately
```r
pigz -d -p 32 MEGAHIT/D?/*.bam.gz &&
anvi-profile -i MEGAHIT/D1/D1_1_sort.bam -c MEGAHIT/D1/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D1/D1_1_profile.db --skip-SNV-profiling --sample-name D1_1 &&
anvi-profile -i MEGAHIT/D1/D1_3_sort.bam -c MEGAHIT/D1/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D1/D1_3_profile.db --skip-SNV-profiling --sample-name D1_3 &&
anvi-profile -i MEGAHIT/D1/D1_5_sort.bam -c MEGAHIT/D1/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D1/D1_5_profile.db --skip-SNV-profiling --sample-name D1_5 &&
anvi-profile -i MEGAHIT/D2/D2_1_sort.bam -c MEGAHIT/D2/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D2/D2_1_profile.db --skip-SNV-profiling --sample-name D2_1 &&
anvi-profile -i MEGAHIT/D2/D2_3_sort.bam -c MEGAHIT/D2/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D2/D2_3_profile.db --skip-SNV-profiling --sample-name D2_3 &&
anvi-profile -i MEGAHIT/D2/D2_5_sort.bam -c MEGAHIT/D2/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D2/D2_5_profile.db --skip-SNV-profiling --sample-name D2_5 &&
anvi-profile -i MEGAHIT/D3/D3_1_sort.bam -c MEGAHIT/D3/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D3/D3_1_profile.db --skip-SNV-profiling --sample-name D3_1 &&
anvi-profile -i MEGAHIT/D3/D3_3_sort.bam -c MEGAHIT/D3/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D3/D3_3_profile.db --skip-SNV-profiling --sample-name D3_3 &&
anvi-profile -i MEGAHIT/D3/D3_5_sort.bam -c MEGAHIT/D3/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D3/D3_5_profile.db --skip-SNV-profiling --sample-name D3_5 &&
anvi-profile -i MEGAHIT/D4/D4_1_sort.bam -c MEGAHIT/D4/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D4/D4_1_profile.db --skip-SNV-profiling --sample-name D4_1 &&
anvi-profile -i MEGAHIT/D4/D4_3_sort.bam -c MEGAHIT/D4/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D4/D4_3_profile.db --skip-SNV-profiling --sample-name D4_3 &&
anvi-profile -i MEGAHIT/D4/D4_5_sort.bam -c MEGAHIT/D4/contigs.db --num-threads 32 --min-contig-length 1500 --output-dir MEGAHIT/D4/D4_5_profile.db --skip-SNV-profiling --sample-name D4_5
```
#STEP Three: Merge BAM profiles within assembly
```r
anvi-merge MEGAHIT/D1/D1_?_profile/PROFILE.db -o MEGAHIT/D1/D1_merged_prof.db -c MEGAHIT/D1/contigs.db -S D1_Merged &&
anvi-merge MEGAHIT/D2/D2_?_profile.db/PROFILE.db -o MEGAHIT/D2/D2_merged_prof.db -c MEGAHIT/D2/contigs.db -S D2_Merged &&
anvi-merge MEGAHIT/D3/D3_?_profile.db/PROFILE.db -o MEGAHIT/D3/D3_merged_prof.db -c MEGAHIT/D3/contigs.db -S D3_Merged &&
anvi-merge MEGAHIT/D4/D4_?_profile.db/PROFILE.db -o MEGAHIT/D4/D4_merged_prof.db -c MEGAHIT/D4/contigs.db -S D4_Merged
```

#Simplify bin names (for Anvio) using custom sed scripts
```r
sed s/[.]/_/ MEGAHIT/D1/DASTOOL/D1_DASTool_scaffolds2bin.txt > MEGAHIT/D1/DASTOOL/simple_D1_DASTool_scaffolds2bin.txt &&
sed s/[.]/_/ MEGAHIT/D2/DASTOOL/D2_DASTool_scaffolds2bin.txt > MEGAHIT/D2/DASTOOL/simple_D2_DASTool_scaffolds2bin.txt &&
sed s/[.]/_/ MEGAHIT/D3/DASTOOL/D3_DASTool_scaffolds2bin.txt > MEGAHIT/D3/DASTOOL/simple_D3_DASTool_scaffolds2bin.txt &&
sed s/[.]/_/ MEGAHIT/D4/DASTOOL/D4_DASTool_scaffolds2bin.txt > MEGAHIT/D4/DASTOOL/simple_D4_DASTool_scaffolds2bin.txt

sed -i s/D1_*/Bin/2 MEGAHIT/D1/DASTOOL/simple_D1_DASTool_scaffolds2bin.txt &&
sed -i s/D2_*/Bin/2 MEGAHIT/D2/DASTOOL/simple_D2_DASTool_scaffolds2bin.txt &&
sed -i s/D3_*/Bin/2 MEGAHIT/D3/DASTOOL/simple_D3_DASTool_scaffolds2bin.txt &&
sed -i s/D4_*/Bin/2 MEGAHIT/D4/DASTOOL/simple_D4_DASTool_scaffolds2bin.txt
```
#STEP Four: Import bins into collection
```r
anvi-import-collection MEGAHIT/D1/DASTOOL/simple_D1_DASTool_scaffolds2bin.txt -p MEGAHIT/D1/D1_merged_prof.db/PROFILE.db -c MEGAHIT/D1/contigs.db --contigs-mode -C D1 &&
anvi-import-collection MEGAHIT/D2/DASTOOL/simple_D2_DASTool_scaffolds2bin.txt -p MEGAHIT/D2/D2_merged_prof.db/PROFILE.db -c MEGAHIT/D2/contigs.db --contigs-mode -C D2 &&
anvi-import-collection MEGAHIT/D3/DASTOOL/simple_D3_DASTool_scaffolds2bin.txt -p MEGAHIT/D3/D3_merged_prof.db/PROFILE.db -c MEGAHIT/D3/contigs.db --contigs-mode -C D3 &&
anvi-import-collection MEGAHIT/D4/DASTOOL/simple_D4_DASTool_scaffolds2bin.txt -p MEGAHIT/D4/D4_merged_prof.db/PROFILE.db -c MEGAHIT/D4/contigs.db --contigs-mode -C D4
```
#STEP Five: Visualize total profile (You will have to do this on a separate browser by using local host ip)
```r
anvi-interactive -p MEGAHIT/D1/D1_merged_prof.db/PROFILE.db -c MEGAHIT/D1/contigs.db -C D1

anvi-refine -p MEGAHIT/D1/D1_merged_prof.db/PROFILE.db -c MEGAHIT/D1/contigs.db -C D1 -b <binname> (for each bin [this will be a lot])

anvi-interactive -p MEGAHIT/D2/D2_merged_prof.db/PROFILE.db -c MEGAHIT/D2/contigs.db -C D2

anvi-refine -p MEGAHIT/D2/D2_merged_prof.db/PROFILE.db -c MEGAHIT/D2/contigs.db -C D2 -b <binname> (for each bin [this will be a lot])

anvi-interactive -p MEGAHIT/D3/D3_merged_prof.db/PROFILE.db -c MEGAHIT/D3/contigs.db -C D3

anvi-refine -p MEGAHIT/D3/D3_merged_prof.db/PROFILE.db -c MEGAHIT/D3/contigs.db -C D3 -b <binname> (for each bin [this will be a lot])

anvi-interactive -p MEGAHIT/D4/D4_merged_prof.db/PROFILE.db -c MEGAHIT/D4/contigs.db -C D4

anvi-refine -p MEGAHIT/D4/D4_merged_prof.db/PROFILE.db -c MEGAHIT/D4/contigs.db -C D4 -b <binname> (for each bin [this will be a lot])

```
#STEP Six: Create new collection of MAGs with >50% completion and <10% redundancy
```r
mkdir MEGAHIT/D1/ANVIO/ &&
anvi-rename-bins -p MEGAHIT/D1/D1_merged_prof.db/PROFILE.db -c MEGAHIT/D1/contigs.db --collection-to-read D1 --collection-to-write D1_MAGs --call-MAGs --prefix D1 --min-completion-for-MAG 50 --max-redundancy-for-MAG 10 --report-file MEGAHIT/D1/ANVIO/D1_MAG_report.txt

mkdir MEGAHIT/D2/ANVIO/ &&
anvi-rename-bins -p MEGAHIT/D2/D2_merged_prof.db/PROFILE.db -c MEGAHIT/D2/contigs.db --collection-to-read D2 --collection-to-write D2_MAGs --call-MAGs --prefix D2 --min-completion-for-MAG 50 --max-redundancy-for-MAG 10 --report-file MEGAHIT/D2/ANVIO/D2_MAG_report.txt

mkdir MEGAHIT/D3/ANVIO/ &&
anvi-rename-bins -p MEGAHIT/D3/D3_merged_prof.db/PROFILE.db -c MEGAHIT/D3/contigs.db --collection-to-read D3 --collection-to-write D3_MAGs --call-MAGs --prefix D3 --min-completion-for-MAG 50 --max-redundancy-for-MAG 10 --report-file MEGAHIT/D3/ANVIO/D3_MAG_report.txt

mkdir MEGAHIT/D4/ANVIO/ &&
anvi-rename-bins -p MEGAHIT/D4/D4_merged_prof.db/PROFILE.db -c MEGAHIT/D4/contigs.db --collection-to-read D4 --collection-to-write D4_MAGs --call-MAGs --prefix D4 --min-completion-for-MAG 50 --max-redundancy-for-MAG 10 --report-file MEGAHIT/D4/ANVIO/D4_MAG_report.txt
```

#STEP Seven: Export MAGs as FASTA
```r
anvi-summarize -p MEGAHIT/D1/D1_merged_prof.db/PROFILE.db -c MEGAHIT/D1/contigs.db -C D1_MAGs -o MEGAHIT/D1/ANVIO/bins &&
anvi-summarize -p MEGAHIT/D2/D2_merged_prof.db/PROFILE.db -c MEGAHIT/D2/contigs.db -C D2_MAGs -o MEGAHIT/D2/ANVIO/bins &&
anvi-summarize -p MEGAHIT/D3/D3_merged_prof.db/PROFILE.db -c MEGAHIT/D3/contigs.db -C D3_MAGs -o MEGAHIT/D3/ANVIO/bins &&
anvi-summarize -p MEGAHIT/D4/D4_merged_prof.db/PROFILE.db -c MEGAHIT/D4/contigs.db -C D4_MAGs -o MEGAHIT/D4/ANVIO/bins
```

#STEP Eight: Clean up file locations
```r
cp MEGAHIT/D1/ANVIO/bins/bin_by_bin/D1_MAG_*/*.fa MEGAHIT/D1/ANVIO/fasta &&
cp MEGAHIT/D2/ANVIO/bins/bin_by_bin/D2_MAG_*/*.fa MEGAHIT/D2/ANVIO/fasta &&
cp MEGAHIT/D3/ANVIO/bins/bin_by_bin/D3_MAG_*/*.fa MEGAHIT/D3/ANVIO/fasta &&
cp MEGAHIT/D4/ANVIO/bins/bin_by_bin/D4_MAG_*/*.fa MEGAHIT/D4/ANVIO/fasta
```

# GENOME + RNA
#Done with bin refinement! Yay
#Now time to make sense of these genomes and start to integrate our metatranscriptome data. If not available, just use genomes for some cool stuff
#GTDBTK for Genome Taxonomy
```r
gtdbtk classify_wf --genome_dir MEGAHIT/D1/ANVIO/fasta --out_dir MEGAHIT/D1/GTDBTK --prefix GTD_D1 --cpus 36 --extension fa &&
gtdbtk classify_wf --genome_dir MEGAHIT/D2/ANVIO/fasta --out_dir MEGAHIT/D2/GTDBTK --prefix GTD_D2 --cpus 36 --extension fa &&
gtdbtk classify_wf --genome_dir MEGAHIT/D3/ANVIO/fasta --out_dir MEGAHIT/D3/GTDBTK --prefix GTD_D3 --cpus 36 --extension fa &&
gtdbtk classify_wf --genome_dir MEGAHIT/D4/ANVIO/fasta --out_dir MEGAHIT/D4/GTDBTK --prefix GTD_D4 --cpus 36 --extension fa
```

#Dereplicate at 99% identity using dRep ver. 3.2.0
```r
dRep dereplicate MEGAHIT/D1/DREP/ -p 36 -g MEGAHIT/D1/ANVIO/fasta/*.fa -comp 50 --checkM_method lineage_wf &&
dRep dereplicate MEGAHIT/D2/DREP/ -p 36 -g MEGAHIT/D2/ANVIO/fasta/*.fa -comp 50 --checkM_method lineage_wf &&
dRep dereplicate MEGAHIT/D3/DREP/ -p 36 -g MEGAHIT/D3/ANVIO/fasta/*.fa -comp 50 --checkM_method lineage_wf &&
dRep dereplicate MEGAHIT/D4/DREP/ -p 36 -g MEGAHIT/D4/ANVIO/fasta/*.fa -comp 50 --checkM_method lineage_wf &&
```

#Pull 16s regions using checkM.
```r
checkm ssu_finder <insert all cyano genomes.fna>
```

#GTDBTK for combined phylogram
```r
gtdbtk classify_wf --genome_dir MEGAHIT/DIEL_COMBINE/MAGS/ --out_dir MEGAHIT/DIEL_COMBINE/GTDBTK --prefix GTD --cpus 36 --extension fa &&
```

#Now run IQTREE For building tree from MSA generated from gtdbtk
```r
iqtree -s MEGAHIT/DIEL_COMBINE/GTDBTK/gtdbtk.bac120.user_msa.fasta -m MFP -B 1500 -nt AUTO
```
#Visualize in iTOL

#DRAM for annotating metagenomes
#First generate the annotationns
```r
DRAM.py annotate -i 'MEGAHIT/D1/ANVIO/fasta/*.fa' -o MEGAHIT/D1/uniDRAM/ --min_contig_size 1500 --gtdb_taxonomy MEGAHIT/D1/GTDBTK/GTD_D1.bac120.summary.tsv --gtdb_taxonomy MEGAHIT/D1/GTDBTK/GTD_D1.ar122.summary.tsv --threads 36 --verbose --use_uniref &&
DRAM.py annotate -i 'MEGAHIT/D2/ANVIO/fasta/*.fa' -o MEGAHIT/D2/uniDRAM/ --min_contig_size 1500 --gtdb_taxonomy MEGAHIT/D2/GTDBTK/GTD_D2.bac120.summary.tsv --threads 36 --verbose --use_uniref &&
DRAM.py annotate -i 'MEGAHIT/D3/ANVIO/fasta/*.fa' -o MEGAHIT/D3/uniDRAM/ --min_contig_size 1500 --gtdb_taxonomy MEGAHIT/D3/GTDBTK/GTD_D3.bac120.summary.tsv --gtdb_taxonomy MEGAHIT/D3/GTDBTK/GTD_D3.ar122.summary.tsv --threads 30 --verbose --use_uniref &&
DRAM.py annotate -i 'MEGAHIT/D4/ANVIO/fasta/*.fa' -o MEGAHIT/D4/uniDRAM/ --min_contig_size 1500 --gtdb_taxonomy MEGAHIT/D4/GTDBTK/GTD_D4.bac120.summary.tsv --gtdb_taxonomy MEGAHIT/D4/GTDBTK/GTD_D4.ar122.summary.tsv --threads 30 --verbose --use_uniref
```

#Next we distill (summarize) the annotations
```r
DRAM.py distill -i MEGAHIT/D1/DRAM/annotations.tsv -o MEGAHIT/D1/DRAM/DISTILL --trna_path MEGAHIT/D1/DRAM/trnas.tsv --rrna_path MEGAHIT/D1/DRAM/rrnas.tsv &&
DRAM.py distill -i MEGAHIT/D1/uniDRAM/annotations.tsv -o MEGAHIT/D1/uniDRAM/DISTILL --trna_path MEGAHIT/D1/uniDRAM/trnas.tsv --rrna_path MEGAHIT/D1/uniDRAM/rrnas.tsv

DRAM.py distill -i MEGAHIT/D2/DRAM/annotations.tsv -o MEGAHIT/D2/DRAM/DISTILL --trna_path MEGAHIT/D2/DRAM/trnas.tsv --rrna_path MEGAHIT/D2/DRAM/rrnas.tsv &&
DRAM.py distill -i MEGAHIT/D2/uniDRAM/annotations.tsv -o MEGAHIT/D2/uniDRAM/DISTILL --trna_path MEGAHIT/D2/DRAM/trnas.tsv --rrna_path MEGAHIT/D2/DRAM/rrnas.tsv &&

DRAM.py distill -i MEGAHIT/D3/DRAM/annotations.tsv -o MEGAHIT/D3/DRAM/DISTILL --trna_path MEGAHIT/D3/DRAM/trnas.tsv --rrna_path MEGAHIT/D3/DRAM/rrnas.tsv &&
DRAM.py distill -i MEGAHIT/D3/uniDRAM/annotations.tsv -o MEGAHIT/D3/uniDRAM/DISTILL --trna_path MEGAHIT/D3/uniDRAM/trnas.tsv --rrna_path MEGAHIT/D3/uniDRAM/rrnas.tsv &&

DRAM.py distill -i MEGAHIT/D4/DRAM/annotations.tsv -o MEGAHIT/D4/DRAM/DISTILL --trna_path MEGAHIT/D4/DRAM/trnas.tsv --rrna_path MEGAHIT/D4/DRAM/rrnas.tsv &&
DRAM.py distill -i MEGAHIT/D4/uniDRAM/annotations.tsv -o
MEGAHIT/D4/uniDRAM/DISTILL --trna_path MEGAHIT/D4/uniDRAM/trnas.tsv --rrna_path
MEGAHIT/D4/uniDRAM/rrnas.tsv
```

#Build BWA index of genomes from DRAM scaffolds output to make sure names match changes in gff and bam
```r
mkdir MEGAHIT/D1/BWA &&
mkdir MEGAHIT/D2/BWA &&
mkdir MEGAHIT/D3/BWA &&
mkdir MEGAHIT/D4/BWA
cp <scaffolds from DRAM> to corresponding BWA
bwa index -p MEGAHIT/D1/BWA/D1_MAGS MEGAHIT/D1/BWA/*.fna &&
bwa index -p MEGAHIT/D2/BWA/D2_MAGS MEGAHIT/D2/BWA/*.fna &&
bwa index -p MEGAHIT/D3/BWA/D3_MAGS MEGAHIT/D3/BWA/*.fna &&
bwa index -p MEGAHIT/D4/BWA/D4_MAGS MEGAHIT/D4/BWA/*.fna
```
#BWA align RNA against DRAM scaffolds MAGS
```r
bwa mem -t 32 MEGAHIT/D1/BWA/D1_MAGS Diel/RNA/raw_data/R1_1/R1_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_1/R1_1_cleaned_rev.fq.gz > MEGAHIT/D1/RNA_MAPS/R1_1.sam &&
samtools view -S -b MEGAHIT/D1/RNA_MAPS/R1_1.sam > MEGAHIT/D1/RNA_MAPS/R1_1.bam -@ 32 &&
samtools sort MEGAHIT/D1/RNA_MAPS/R1_1.bam -o MEGAHIT/D1/RNA_MAPS/R1_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/RNA_MAPS/R1_1_sort.bam -@ 32 &&
rm MEGAHIT/D1/RNA_MAPS/R1_1.sam &&
rm MEGAHIT/D1/RNA_MAPS/R1_1.bam &&
pigz MEGAHIT/D1/RNA_MAPS/R1_1_sort.bam -p 32 &&
bwa mem -t 36 MEGAHIT/D1/BWA/D1_MAGS Diel/RNA/raw_data/R1_2/R1_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_2/R1_2_cleaned_rev.fq.gz > MEGAHIT/D1/RNA_MAPS/R1_2.sam &&
samtools view -S -b MEGAHIT/D1/RNA_MAPS/R1_2.sam > MEGAHIT/D1/RNA_MAPS/R1_2.bam -@ 32 &&
samtools sort MEGAHIT/D1/RNA_MAPS/R1_2.bam -o MEGAHIT/D1/RNA_MAPS/R1_2_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/RNA_MAPS/R1_2_sort.bam -@ 32 &&
rm MEGAHIT/D1/RNA_MAPS/R1_2.sam &&
rm MEGAHIT/D1/RNA_MAPS/R1_2.bam &&
pigz MEGAHIT/D1/RNA_MAPS/R1_2_sort.bam -p 32 &&
bwa mem -t 36 MEGAHIT/D1/BWA/D1_MAGS Diel/RNA/raw_data/R1_3/R1_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_3/R1_3_cleaned_rev.fq.gz > MEGAHIT/D1/RNA_MAPS/R1_3.sam &&
samtools view -S -b MEGAHIT/D1/RNA_MAPS/R1_3.sam > MEGAHIT/D1/RNA_MAPS/R1_3.bam -@ 32 &&
samtools sort MEGAHIT/D1/RNA_MAPS/R1_3.bam -o MEGAHIT/D1/RNA_MAPS/R1_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/RNA_MAPS/R1_3_sort.bam -@ 32 &&
rm MEGAHIT/D1/RNA_MAPS/R1_3.sam &&
rm MEGAHIT/D1/RNA_MAPS/R1_3.bam &&
pigz MEGAHIT/D1/RNA_MAPS/R1_3_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D1/BWA/D1_MAGS Diel/RNA/raw_data/R1_4/R1_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_4/R1_4_cleaned_rev.fq.gz > MEGAHIT/D1/RNA_MAPS/R1_4.sam &&
samtools view -S -b MEGAHIT/D1/RNA_MAPS/R1_4.sam > MEGAHIT/D1/RNA_MAPS/R1_4.bam -@ 32 &&
samtools sort MEGAHIT/D1/RNA_MAPS/R1_4.bam -o MEGAHIT/D1/RNA_MAPS/R1_4_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/RNA_MAPS/R1_4_sort.bam -@ 32 &&
rm MEGAHIT/D1/RNA_MAPS/R1_4.sam &&
rm MEGAHIT/D1/RNA_MAPS/R1_4.bam &&
pigz MEGAHIT/D1/RNA_MAPS/R1_4_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D1/BWA/D1_MAGS Diel/RNA/raw_data/R1_5/R1_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_5/R1_5_cleaned_rev.fq.gz > MEGAHIT/D1/RNA_MAPS/R1_5.sam &&
samtools view -S -b MEGAHIT/D1/RNA_MAPS/R1_5.sam > MEGAHIT/D1/RNA_MAPS/R1_5.bam -@ 32 &&
samtools sort MEGAHIT/D1/RNA_MAPS/R1_5.bam -o MEGAHIT/D1/RNA_MAPS/R1_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D1/RNA_MAPS/R1_5_sort.bam -@ 32 &&
rm MEGAHIT/D1/RNA_MAPS/R1_5.sam &&
rm MEGAHIT/D1/RNA_MAPS/R1_5.bam &&
pigz MEGAHIT/D1/RNA_MAPS/R1_5_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D2/BWA/D2_MAGS Diel/RNA/raw_data/R2_1/R2_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_1/R2_1_cleaned_rev.fq.gz > MEGAHIT/D2/RNA_MAPS/R2_1.sam &&
samtools view -S -b MEGAHIT/D2/RNA_MAPS/R2_1.sam > MEGAHIT/D2/RNA_MAPS/R2_1.bam -@ 32 &&
samtools sort MEGAHIT/D2/RNA_MAPS/R2_1.bam -o MEGAHIT/D2/RNA_MAPS/R2_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/RNA_MAPS/R2_1_sort.bam -@ 32 &&
rm MEGAHIT/D2/RNA_MAPS/R2_1.sam &&
rm MEGAHIT/D2/RNA_MAPS/R2_1.bam &&
pigz MEGAHIT/D2/RNA_MAPS/R2_1_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D2/BWA/D2_MAGS Diel/RNA/raw_data/R2_2/R2_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_2/R2_2_cleaned_rev.fq.gz > MEGAHIT/D2/RNA_MAPS/R2_2.sam &&
samtools view -S -b MEGAHIT/D2/RNA_MAPS/R2_2.sam > MEGAHIT/D2/RNA_MAPS/R2_2.bam -@ 32 &&
samtools sort MEGAHIT/D2/RNA_MAPS/R2_2.bam -o MEGAHIT/D2/RNA_MAPS/R2_2_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/RNA_MAPS/R2_2_sort.bam -@ 32 &&
rm MEGAHIT/D2/RNA_MAPS/R2_2.sam &&
rm MEGAHIT/D2/RNA_MAPS/R2_2.bam &&
pigz MEGAHIT/D2/RNA_MAPS/R2_2_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D2/BWA/D2_MAGS Diel/RNA/raw_data/R2_3/R2_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_3/R2_3_cleaned_rev.fq.gz > MEGAHIT/D2/RNA_MAPS/R2_3.sam &&
samtools view -S -b MEGAHIT/D2/RNA_MAPS/R2_3.sam > MEGAHIT/D2/RNA_MAPS/R2_3.bam -@ 32 &&
samtools sort MEGAHIT/D2/RNA_MAPS/R2_3.bam -o MEGAHIT/D2/RNA_MAPS/R2_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/RNA_MAPS/R2_3_sort.bam -@ 32 &&
rm MEGAHIT/D2/RNA_MAPS/R2_3.sam &&
rm MEGAHIT/D2/RNA_MAPS/R2_3.bam &&
pigz MEGAHIT/D2/RNA_MAPS/R2_3_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D2/BWA/D2_MAGS Diel/RNA/raw_data/R2_4/R2_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_4/R2_4_cleaned_rev.fq.gz > MEGAHIT/D2/RNA_MAPS/R2_4.sam &&
samtools view -S -b MEGAHIT/D2/RNA_MAPS/R2_4.sam > MEGAHIT/D2/RNA_MAPS/R2_4.bam -@ 32 &&
samtools sort MEGAHIT/D2/RNA_MAPS/R2_4.bam -o MEGAHIT/D2/RNA_MAPS/R2_4_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/RNA_MAPS/R2_4_sort.bam -@ 32 &&
rm MEGAHIT/D2/RNA_MAPS/R2_4.sam &&
rm MEGAHIT/D2/RNA_MAPS/R2_4.bam &&
pigz MEGAHIT/D2/RNA_MAPS/R2_4_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D2/BWA/D2_MAGS Diel/RNA/raw_data/R2_5/R2_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_5/R2_5_cleaned_rev.fq.gz > MEGAHIT/D2/RNA_MAPS/R2_5.sam &&
samtools view -S -b MEGAHIT/D2/RNA_MAPS/R2_5.sam > MEGAHIT/D2/RNA_MAPS/R2_5.bam -@ 32 &&
samtools sort MEGAHIT/D2/RNA_MAPS/R2_5.bam -o MEGAHIT/D2/RNA_MAPS/R2_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D2/RNA_MAPS/R2_5_sort.bam -@ 32 &&
rm MEGAHIT/D2/RNA_MAPS/R2_5.sam &&
rm MEGAHIT/D2/RNA_MAPS/R2_5.bam &&
pigz MEGAHIT/D2/RNA_MAPS/R2_5_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D3/BWA/D3_MAGS Diel/RNA/raw_data/R3_1/R3_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_1/R3_1_cleaned_rev.fq.gz > MEGAHIT/D3/RNA_MAPS/R3_1.sam &&
samtools view -S -b MEGAHIT/D3/RNA_MAPS/R3_1.sam > MEGAHIT/D3/RNA_MAPS/R3_1.bam -@ 32 &&
samtools sort MEGAHIT/D3/RNA_MAPS/R3_1.bam -o MEGAHIT/D3/RNA_MAPS/R3_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/RNA_MAPS/R3_1_sort.bam -@ 32 &&
rm MEGAHIT/D3/RNA_MAPS/R3_1.sam &&
rm MEGAHIT/D3/RNA_MAPS/R3_1.bam &&
pigz MEGAHIT/D3/RNA_MAPS/R3_1_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D3/BWA/D3_MAGS Diel/RNA/raw_data/R3_2/R3_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_2/R3_2_cleaned_rev.fq.gz > MEGAHIT/D3/RNA_MAPS/R3_2.sam &&
samtools view -S -b MEGAHIT/D3/RNA_MAPS/R3_2.sam > MEGAHIT/D3/RNA_MAPS/R3_2.bam -@ 32 &&
samtools sort MEGAHIT/D3/RNA_MAPS/R3_2.bam -o MEGAHIT/D3/RNA_MAPS/R3_2_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/RNA_MAPS/R3_2_sort.bam -@ 32 &&
rm MEGAHIT/D3/RNA_MAPS/R3_2.sam &&
rm MEGAHIT/D3/RNA_MAPS/R3_2.bam &&
pigz MEGAHIT/D3/RNA_MAPS/R3_2_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D3/BWA/D3_MAGS Diel/RNA/raw_data/R3_3/R3_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_3/R3_3_cleaned_rev.fq.gz > MEGAHIT/D3/RNA_MAPS/R3_3.sam &&
samtools view -S -b MEGAHIT/D3/RNA_MAPS/R3_3.sam > MEGAHIT/D3/RNA_MAPS/R3_3.bam -@ 32 &&
samtools sort MEGAHIT/D3/RNA_MAPS/R3_3.bam -o MEGAHIT/D3/RNA_MAPS/R3_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/RNA_MAPS/R3_3_sort.bam -@ 32 &&
rm MEGAHIT/D3/RNA_MAPS/R3_3.sam &&
rm MEGAHIT/D3/RNA_MAPS/R3_3.bam &&
pigz MEGAHIT/D3/RNA_MAPS/R3_3_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D3/BWA/D3_MAGS Diel/RNA/raw_data/R3_4/R3_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_4/R3_4_cleaned_rev.fq.gz > MEGAHIT/D3/RNA_MAPS/R3_4.sam &&
samtools view -S -b MEGAHIT/D3/RNA_MAPS/R3_4.sam > MEGAHIT/D3/RNA_MAPS/R3_4.bam -@ 32 &&
samtools sort MEGAHIT/D3/RNA_MAPS/R3_4.bam -o MEGAHIT/D3/RNA_MAPS/R3_4_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/RNA_MAPS/R3_4_sort.bam -@ 32 &&
rm MEGAHIT/D3/RNA_MAPS/R3_4.sam &&
rm MEGAHIT/D3/RNA_MAPS/R3_4.bam &&
pigz MEGAHIT/D3/RNA_MAPS/R3_4_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D3/BWA/D3_MAGS Diel/RNA/raw_data/R3_5/R3_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_5/R3_5_cleaned_rev.fq.gz > MEGAHIT/D3/RNA_MAPS/R3_5.sam &&
samtools view -S -b MEGAHIT/D3/RNA_MAPS/R3_5.sam > MEGAHIT/D3/RNA_MAPS/R3_5.bam -@ 32 &&
samtools sort MEGAHIT/D3/RNA_MAPS/R3_5.bam -o MEGAHIT/D3/RNA_MAPS/R3_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D3/RNA_MAPS/R3_5_sort.bam -@ 32 &&
rm MEGAHIT/D3/RNA_MAPS/R3_5.sam &&
rm MEGAHIT/D3/RNA_MAPS/R3_5.bam &&
pigz MEGAHIT/D3/RNA_MAPS/R3_5_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D4/BWA/D4_MAGS Diel/RNA/raw_data/R4_1/R4_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_1/R4_1_cleaned_rev.fq.gz > MEGAHIT/D4/RNA_MAPS/R4_1.sam &&
samtools view -S -b MEGAHIT/D4/RNA_MAPS/R4_1.sam > MEGAHIT/D4/RNA_MAPS/R4_1.bam -@ 32 &&
samtools sort MEGAHIT/D4/RNA_MAPS/R4_1.bam -o MEGAHIT/D4/RNA_MAPS/R4_1_sort.bam -@ 32 &&
samtools index MEGAHIT/D4/RNA_MAPS/R4_1_sort.bam -@ 32 &&
rm MEGAHIT/D4/RNA_MAPS/R4_1.sam &&
rm MEGAHIT/D4/RNA_MAPS/R4_1.bam &&
pigz MEGAHIT/D4/RNA_MAPS/R4_1_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D4/BWA/D4_MAGS Diel/RNA/raw_data/R4_2/R4_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_2/R4_2_cleaned_rev.fq.gz > MEGAHIT/D4/RNA_MAPS/R4_2.sam &&
samtools view -S -b MEGAHIT/D4/RNA_MAPS/R4_2.sam > MEGAHIT/D4/RNA_MAPS/R4_2.bam -@ 32 &&
samtools sort MEGAHIT/D4/RNA_MAPS/R4_2.bam -o MEGAHIT/D4/RNA_MAPS/R4_2_sort.bam -@ 32 &&
samtools index MEGAHIT/D4/RNA_MAPS/R4_2_sort.bam -@ 32 &&
rm MEGAHIT/D4/RNA_MAPS/R4_2.sam &&
rm MEGAHIT/D4/RNA_MAPS/R4_2.bam &&
pigz MEGAHIT/D4/RNA_MAPS/R4_2_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D4/BWA/D4_MAGS Diel/RNA/raw_data/R4_3/R4_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_3/R4_3_cleaned_rev.fq.gz > MEGAHIT/D4/RNA_MAPS/R4_3.sam &&
samtools view -S -b MEGAHIT/D4/RNA_MAPS/R4_3.sam > MEGAHIT/D4/RNA_MAPS/R4_3.bam -@ 32 &&
samtools sort MEGAHIT/D4/RNA_MAPS/R4_3.bam -o MEGAHIT/D4/RNA_MAPS/R4_3_sort.bam -@ 32 &&
samtools index MEGAHIT/D4/RNA_MAPS/R4_3_sort.bam -@ 32 &&
rm MEGAHIT/D4/RNA_MAPS/R4_3.sam &&
rm MEGAHIT/D4/RNA_MAPS/R4_3.bam &&
pigz MEGAHIT/D4/RNA_MAPS/R4_3_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D4/BWA/D4_MAGS Diel/RNA/raw_data/R4_4/R4_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_4/R4_4_cleaned_rev.fq.gz > MEGAHIT/D4/RNA_MAPS/R4_4.sam &&
samtools view -S -b MEGAHIT/D4/RNA_MAPS/R4_4.sam > MEGAHIT/D4/RNA_MAPS/R4_4.bam -@ 32 &&
samtools sort MEGAHIT/D4/RNA_MAPS/R4_4.bam -o MEGAHIT/D4/RNA_MAPS/R4_4_sort.bam -@ 32 &&
samtools index MEGAHIT/D4/RNA_MAPS/R4_4_sort.bam -@ 32 &&
rm MEGAHIT/D4/RNA_MAPS/R4_4.sam &&
rm MEGAHIT/D4/RNA_MAPS/R4_4.bam &&
pigz MEGAHIT/D4/RNA_MAPS/R4_4_sort.bam -p 32 &&
bwa mem -t 32 MEGAHIT/D4/BWA/D4_MAGS Diel/RNA/raw_data/R4_5/R4_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_5/R4_5_cleaned_rev.fq.gz > MEGAHIT/D4/RNA_MAPS/R4_5.sam &&
samtools view -S -b MEGAHIT/D4/RNA_MAPS/R4_5.sam > MEGAHIT/D4/RNA_MAPS/R4_5.bam -@ 32 &&
samtools sort MEGAHIT/D4/RNA_MAPS/R4_5.bam -o MEGAHIT/D4/RNA_MAPS/R4_5_sort.bam -@ 32 &&
samtools index MEGAHIT/D4/RNA_MAPS/R4_5_sort.bam -@ 32 &&
rm MEGAHIT/D4/RNA_MAPS/R4_5.sam &&
rm MEGAHIT/D4/RNA_MAPS/R4_5.bam &&
pigz MEGAHIT/D4/RNA_MAPS/R4_5_sort.bam -p 32
```

# Build bowtie index of genomes
```r
mkdir MEGAHIT/D1/ANVIO/BOWTIE &&
mkdir MEGAHIT/D2/ANVIO/BOWTIE &&
mkdir MEGAHIT/D3/ANVIO/BOWTIE &&
mkdir MEGAHIT/D4/ANVIO/BOWTIE

bowtie2-build MEGAHIT/D1/ANVIO/fasta/D1_MAG_00001-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00002-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00003-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00004-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00005-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00006-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00007-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00008-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00009-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00010-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00011-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00012-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00013-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00015-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00016-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00017-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00018-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00019-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00020-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00021-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00022-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00023-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00024-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00025-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00026-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00027-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00028-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00029-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00030-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00031-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00032-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00033-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00034-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00035-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00036-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00037-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00038-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00039-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00040-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00041-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00042-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00043-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00044-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00045-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00046-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00047-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00048-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00049-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00050-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00051-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00052-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00053-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00054-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00055-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00056-contigs.fa,MEGAHIT/D1/ANVIO/fasta/D1_MAG_00057-contigs.fa MEGAHIT/D1/ANVIO/BOWTIE/D1_MAGs -f --threads 36 &&
bowtie2-build MEGAHIT/D2/ANVIO/fasta/D2_MAG_00001-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00002-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00003-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00004-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00005-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00006-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00007-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00008-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00009-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00010-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00011-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00012-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00013-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00014-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00015-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00016-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00017-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00018-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00019-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00021-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00022-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00023-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00024-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00025-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00026-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00027-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00028-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00029-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00030-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00031-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00032-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00033-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00034-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00035-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00036-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00037-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00038-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00039-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00040-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00041-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00042-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00043-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00044-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00045-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00046-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00047-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00048-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00049-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00050-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00051-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00052-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00053-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00054-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00055-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00056-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00057-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00058-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00059-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00060-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00061-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00062-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00063-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00064-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00065-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00066-contigs.fa,MEGAHIT/D2/ANVIO/fasta/D2_MAG_00067-contigs.fa MEGAHIT/D2/ANVIO/BOWTIE/D2_MAGs -f --threads 36 &&
bowtie2-build MEGAHIT/D3/ANVIO/fasta/D3_MAG_00001-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00002-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00003-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00004-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00005-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00006-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00007-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00008-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00009-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00010-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00011-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00012-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00013-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00014-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00015-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00016-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00017-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00018-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00019-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00020-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00021-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00022-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00023-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00024-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00025-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00026-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00027-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00028-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00029-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00030-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00031-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00032-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00033-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00034-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00035-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00036-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00037-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00038-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00040-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00041-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00042-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00043-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00044-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00045-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00046-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00047-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00048-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00049-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00050-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00051-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00052-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00053-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00054-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00055-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00056-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00057-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00058-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00059-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00060-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00061-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00062-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00063-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00064-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00065-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00066-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00067-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00068-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00069-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00070-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00071-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00072-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00073-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00074-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00075-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00076-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00077-contigs.fa,MEGAHIT/D3/ANVIO/fasta/D3_MAG_00078-contigs.fa MEGAHIT/D3/ANVIO/BOWTIE/D3_MAGs -f --threads 36 &&
bowtie2-build MEGAHIT/D4/ANVIO/fasta/D4_MAG_00001-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00002-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00003-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00004-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00005-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00006-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00007-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00008-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00009-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00010-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00011-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00012-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00013-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00014-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00015-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00016-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00017-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00018-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00019-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00021-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00022-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00023-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00024-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00025-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00026-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00027-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00028-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00029-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00030-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00031-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00032-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00033-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00034-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00035-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00036-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00037-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00038-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00039-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00040-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00041-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00042-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00043-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00044-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00045-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00046-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00047-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00048-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00049-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00050-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00051-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00052-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00053-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00054-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00055-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00056-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00057-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00058-contigs.fa,MEGAHIT/D4/ANVIO/fasta/D4_MAG_00059-contigs.fa MEGAHIT/D4/ANVIO/BOWTIE/D4_MAGs -f --threads 36
```

#Map DNA against Genomes
```r
bowtie2 -x MEGAHIT/D1/ANVIO/BOWTIE/D1_MAGs -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_1_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_1_mag.sam > MEGAHIT/D1/DNA_MAPS/D1_1_mag.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_1_mag.bam -o MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_mag.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_mag.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D1/ANVIO/BOWTIE/D1_MAGs -1 Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_3_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_3_mag.sam > MEGAHIT/D1/DNA_MAPS/D1_3_mag.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_3_mag.bam -o MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_mag.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_mag.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D1/ANVIO/BOWTIE/D1_MAGs -1 Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_5_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_5_mag.sam > MEGAHIT/D1/DNA_MAPS/D1_5_mag.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_5_mag.bam -o MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_mag.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_mag.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/ANVIO/BOWTIE/D2_MAGs -1 Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_1_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_1_mag.sam > MEGAHIT/D2/DNA_MAPS/D2_1_mag.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_1_mag.bam -o MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_mag.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_mag.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/ANVIO/BOWTIE/D2_MAGs -1 Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_3_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_3_mag.sam > MEGAHIT/D2/DNA_MAPS/D2_3_mag.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_3_mag.bam -o MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_mag.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_mag.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/ANVIO/BOWTIE/D2_MAGs -1 Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_5_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_5_mag.sam > MEGAHIT/D2/DNA_MAPS/D2_5_mag.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_5_mag.bam -o MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_mag.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_mag.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/ANVIO/BOWTIE/D3_MAGs -1 Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_1_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_1_mag.sam > MEGAHIT/D3/DNA_MAPS/D3_1_mag.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_1_mag.bam -o MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_mag.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_mag.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/ANVIO/BOWTIE/D3_MAGs -1 Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_3_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_3_mag.sam > MEGAHIT/D3/DNA_MAPS/D3_3_mag.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_3_mag.bam -o MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_mag.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_mag.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/ANVIO/BOWTIE/D3_MAGs -1 Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_5_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_5_mag.sam > MEGAHIT/D3/DNA_MAPS/D3_5_mag.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_5_mag.bam -o MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_mag.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_mag.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/ANVIO/BOWTIE/D4_MAGs -1 Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_1_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_1_mag.sam > MEGAHIT/D4/DNA_MAPS/D4_1_mag.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_1_mag.bam -o MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_mag.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_mag.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/ANVIO/BOWTIE/D4_MAGs -1 Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_3_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_3_mag.sam > MEGAHIT/D4/DNA_MAPS/D4_3_mag.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_3_mag.bam -o MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_mag.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_mag.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/ANVIO/BOWTIE/D4_MAGs -1 Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_5_mag.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_5_mag.sam > MEGAHIT/D4/DNA_MAPS/D4_5_mag.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_5_mag.bam -o MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_mag.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_mag.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag.bam -p 32
```

#Coverm for genome abundances (relative abundance)
```r
coverm genome --bam-files MEGAHIT/D1/DNA_MAPS/D1_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D1/ANVIO/fasta/ -x fa -m relative_abundance -t 5 -o MEGAHIT/D1/DNA_MAPS/genome_props.tsv &&
coverm genome --bam-files MEGAHIT/D2/DNA_MAPS/D2_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D2/ANVIO/fasta/ -x fa -m relative_abundance -t 5 -o MEGAHIT/D2/DNA_MAPS/genome_props.tsv &&
coverm genome --bam-files MEGAHIT/D3/DNA_MAPS/D3_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D3/ANVIO/fasta/ -x fa -m relative_abundance -t 5 -o MEGAHIT/D3/DNA_MAPS/genome_props.tsv &&
coverm genome --bam-files MEGAHIT/D4/DNA_MAPS/D4_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D4/ANVIO/fasta/ -x fa -m relative_abundance -t 5 -o MEGAHIT/D4/DNA_MAPS/genome_props.tsv
```
#Coverm for genome abundances (TPM)
```r
coverm genome --bam-files MEGAHIT/D1/DNA_MAPS/D1_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D1/ANVIO/fasta/ -x fa -m tpm -t 5 -o MEGAHIT/D1/DNA_MAPS/genome_tpm.tsv &&
coverm genome --bam-files MEGAHIT/D2/DNA_MAPS/D2_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D2/ANVIO/fasta/ -x fa -m tpm -t 5 -o MEGAHIT/D2/DNA_MAPS/genome_tpm.tsv &&
coverm genome --bam-files MEGAHIT/D3/DNA_MAPS/D3_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D3/ANVIO/fasta/ -x fa -m tpm -t 5 -o MEGAHIT/D3/DNA_MAPS/genome_tpm.tsv &&
coverm genome --bam-files MEGAHIT/D4/DNA_MAPS/D4_?_sort_mag.bam --genome-fasta-directory MEGAHIT/D4/ANVIO/fasta/ -x fa -m tpm -t 5 -o MEGAHIT/D4/DNA_MAPS/genome_tpm.tsv
```

#Use featureCounts ver. 2.0.1 to extract counts per gene region on MAGs
```r
featureCounts -a MEGAHIT/D1/uniDRAM/genes.gff -o MEGAHIT/D1/RNA_MAPS/D1_RNA_counts.tsv MEGAHIT/D1/RNA_MAPS/*.bam -T 20 -F GFF -t CDS -g ID -p &&

featureCounts -a MEGAHIT/D2/uniDRAM/genes.gff -o MEGAHIT/D2/RNA_MAPS/D2_RNA_counts.tsv MEGAHIT/D2/RNA_MAPS/*.bam -T 20 -F GFF -t CDS -g ID -p

featureCounts -a MEGAHIT/D3/uniDRAM/genes.gff -o MEGAHIT/D3/RNA_MAPS/D3_RNA_counts.tsv MEGAHIT/D3/RNA_MAPS/*.bam -T 20 -F GFF -t CDS -g ID -p

featureCounts -a MEGAHIT/D4/uniDRAM/genes.gff -o MEGAHIT/D4/RNA_MAPS/D4_RNA_counts.tsv MEGAHIT/D4/RNA_MAPS/*.bam -T 20 -F GFF -t CDS -g ID -p
```

#FASTANI ver 1.32 for estimating Average nucleotide identity among dominant cyanobacterial Genomes
#We will do a series of pairwise comparisons: 1-2, 1-3, 1-4, 2-3, 2-4, 3-4
```r
#1-2
fastANI -r MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa -q MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa -t 5 -o Cyano_ANI_1_2.tsv &&
#1-3
fastANI -r MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa -q MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa -t 5 -o Cyano_ANI_1_3.tsv &&
#1-4
fastANI -r MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa -q MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa -t 5 -o Cyano_ANI_1_4.tsv &&
#2-3
fastANI -r MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa -q MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa -t 5 -o Cyano_ANI_2_3.tsv &&
#2-4
fastANI -r MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa -q MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa -t 5 -o Cyano_ANI_2_4.tsv &&
#3-4
fastANI -r MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa -q MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa -t 5 -o Cyano_ANI_3_4.tsv
#Random just to get an idea of what distance looks like - use beggiatoaceae with cyano
fastANI -r MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa -q MEGAHIT/D4/ANVIO/fasta/D4_MAG_00006-contigs.fa -t 5 -o Begg_ANI_C_B.tsv --minFraction 0
#It was ~0.7, so ~0.99 for other cyano comparisons can be trusted
```
#antiSMASH for secondary metabolite prediction on MAGs
```r
antismash --cb-general --cb-knownclusters --cb-subclusters --asf --pfam2go --output-dir antismash/D1 --output-basename D1_sm --genefinding-tool prodigal-m MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa -c 15 &&
antismash --cb-general --cb-knownclusters --cb-subclusters --asf --pfam2go --output-dir antismash/D2 --output-basename D2_sm --genefinding-tool prodigal-m MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa -c 15 &&
antismash --cb-general --cb-knownclusters --cb-subclusters --asf --pfam2go --output-dir antismash/D3 --output-basename D3_sm --genefinding-tool prodigal-m MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa -c 15 &&
antismash --cb-general --cb-knownclusters --cb-subclusters --asf --pfam2go --output-dir antismash/D4 --output-basename D4_sm --genefinding-tool prodigal-m MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa -c 15
```

#Convert genbank output to fasta for mapping
```r
python3
from Bio import SeqIO
SeqIO.convert("antismash/D1/D1_1047248.region001.gbk", "genbank", "antismash/D1/D1_1047248.fna", "fasta")
SeqIO.convert("antismash/D1/D1_1225210.region001.gbk", "genbank", "antismash/D1/D1_1225210.fna", "fasta")
SeqIO.convert("antismash/D1/D1_174240.region001.gbk", "genbank", "antismash/D1/D1_174240.fna", "fasta")
SeqIO.convert("antismash/D1/D1_1763017.region001.gbk", "genbank", "antismash/D1/D1_1763017.fna", "fasta")
SeqIO.convert("antismash/D1/D1_1773565.region001.gbk", "genbank", "antismash/D1/D1_1773565.fna", "fasta")
SeqIO.convert("antismash/D1/D1_184062.region001.gbk", "genbank", "antismash/D1/D1_184062.fna", "fasta")
SeqIO.convert("antismash/D1/D1_222622.region001.gbk", "genbank", "antismash/D1/D1_222622.fna", "fasta")
SeqIO.convert("antismash/D1/D1_2750804.region001.gbk", "genbank", "antismash/D1/D1_2750804.fna", "fasta")
SeqIO.convert("antismash/D1/D1_3377743.region001.gbk", "genbank", "antismash/D1/D1_3377743.fna", "fasta")
SeqIO.convert("antismash/D1/D1_3598975.region001.gbk", "genbank", "antismash/D1/D1_3598975.fna", "fasta")
SeqIO.convert("antismash/D1/D1_3634944.region001.gbk", "genbank", "antismash/D1/D1_3634944.fna", "fasta")
SeqIO.convert("antismash/D1/D1_404272.region001.gbk", "genbank", "antismash/D1/D1_404272.fna", "fasta")
SeqIO.convert("antismash/D1/D1_901414.region001.gbk", "genbank", "antismash/D1/D1_901414.fna", "fasta")
SeqIO.convert("antismash/D1/D1_917871.region001.gbk", "genbank", "antismash/D1/D1_917871.fna", "fasta")
SeqIO.convert("antismash/D2/D2_1208935.region001.gbk", "genbank", "antismash/D2/D2_1208935.fna", "fasta")
SeqIO.convert("antismash/D2/D2_1492134.region001.gbk", "genbank", "antismash/D2/D2_1492134.fna", "fasta")
SeqIO.convert("antismash/D2/D2_1545942.region001.gbk", "genbank", "antismash/D2/D2_1545942.fna", "fasta")
SeqIO.convert("antismash/D2/D2_1855330.region001.gbk", "genbank", "antismash/D2/D2_1855330.fna", "fasta")
SeqIO.convert("antismash/D2/D2_1923794.region001.gbk", "genbank", "antismash/D2/D2_1923794.fna", "fasta")
SeqIO.convert("antismash/D2/D2_2428174.region001.gbk", "genbank", "antismash/D2/D2_2428174.fna", "fasta")
SeqIO.convert("antismash/D2/D2_2429715.region001.gbk", "genbank", "antismash/D2/D2_2429715.fna", "fasta")
SeqIO.convert("antismash/D2/D2_26512.region001.gbk", "genbank", "antismash/D2/D2_26512.fna", "fasta")
SeqIO.convert("antismash/D2/D2_344242.region001.gbk", "genbank", "antismash/D2/D2_344242.fna", "fasta")
SeqIO.convert("antismash/D2/D2_4915479.region001.gbk", "genbank", "antismash/D2/D2_4915479.fna", "fasta")
SeqIO.convert("antismash/D2/D2_6265667.region001.gbk", "genbank", "antismash/D2/D2_6265667.fna", "fasta")
SeqIO.convert("antismash/D2/D2_6618009.region001.gbk", "genbank", "antismash/D2/D2_6618009.fna", "fasta")
SeqIO.convert("antismash/D2/D2_6796901.region001.gbk", "genbank", "antismash/D2/D2_6796901.fna", "fasta")
SeqIO.convert("antismash/D2/D2_6823005.region001.gbk", "genbank", "antismash/D2/D2_6823005.fna", "fasta")
SeqIO.convert("antismash/D2/D2_7493485.region001.gbk", "genbank", "antismash/D2/D2_7493485.fna", "fasta")
SeqIO.convert("antismash/D2/D2_7931330.region001.gbk", "genbank", "antismash/D2/D2_7931330.fna", "fasta")
SeqIO.convert("antismash/D2/D2_8289884.region001.gbk", "genbank", "antismash/D2/D2_8289884.fna", "fasta")
SeqIO.convert("antismash/D3/D3_1490179.region001.gbk", "genbank", "antismash/D3/D3_1490179.fna", "fasta")
SeqIO.convert("antismash/D3/D3_2537856.region001.gbk", "genbank", "antismash/D3/D3_2537856.fna", "fasta")
SeqIO.convert("antismash/D3/D3_3765204.region001.gbk", "genbank", "antismash/D3/D3_3765204.fna", "fasta")
SeqIO.convert("antismash/D3/D3_4603503.region001.gbk", "genbank", "antismash/D3/D3_4603503.fna", "fasta")
SeqIO.convert("antismash/D3/D3_4639079.region001.gbk", "genbank", "antismash/D3/D3_4639079.fna", "fasta")
SeqIO.convert("antismash/D3/D3_5107247.region001.gbk", "genbank", "antismash/D3/D3_5107247.fna", "fasta")
SeqIO.convert("antismash/D3/D3_5156618.region001.gbk", "genbank", "antismash/D3/D3_5156618.fna", "fasta")
SeqIO.convert("antismash/D3/D3_5636171.region001.gbk", "genbank", "antismash/D3/D3_5636171.fna", "fasta")
SeqIO.convert("antismash/D3/D3_672693.region001.gbk", "genbank", "antismash/D3/D3_672693.fna", "fasta")
SeqIO.convert("antismash/D3/D3_7365259.region001.gbk", "genbank", "antismash/D3/D3_7365259.fna", "fasta")
SeqIO.convert("antismash/D3/D3_8187938.region001.gbk", "genbank", "antismash/D3/D3_8187938.fna", "fasta")
SeqIO.convert("antismash/D3/D3_9647191.region001.gbk", "genbank", "antismash/D3/D3_9647191.fna", "fasta")
SeqIO.convert("antismash/D4/D4_1413802.region001.gbk", "genbank", "antismash/D4/D4_1413802.fna", "fasta")
SeqIO.convert("antismash/D4/D4_2405581.region001.gbk", "genbank", "antismash/D4/D4_2405581.fna", "fasta")
SeqIO.convert("antismash/D4/D4_2756514.region001.gbk", "genbank", "antismash/D4/D4_2756514.fna", "fasta")
SeqIO.convert("antismash/D4/D4_3080778.region001.gbk", "genbank", "antismash/D4/D4_3080778.fna", "fasta")
SeqIO.convert("antismash/D4/D4_3686870.region001.gbk", "genbank", "antismash/D4/D4_3686870.fna", "fasta")
SeqIO.convert("antismash/D4/D4_403945.region001.gbk", "genbank", "antismash/D4/D4_403945.fna", "fasta")
SeqIO.convert("antismash/D4/D4_4062695.region001.gbk", "genbank", "antismash/D4/D4_4062695.fna", "fasta")
SeqIO.convert("antismash/D4/D4_4334955.region001.gbk", "genbank", "antismash/D4/D4_4334955.fna", "fasta")
SeqIO.convert("antismash/D4/D4_5702560.region001.gbk", "genbank", "antismash/D4/D4_5702560.fna", "fasta")
SeqIO.convert("antismash/D4/D4_5881646.region001.gbk", "genbank", "antismash/D4/D4_5881646.fna", "fasta")
SeqIO.convert("antismash/D4/D4_636883.region001.gbk", "genbank", "antismash/D4/D4_636883.fna", "fasta")
SeqIO.convert("antismash/D4/D4_88900.region001.gbk", "genbank", "antismash/D4/D4_88900.fna", "fasta")
```
#Create bwa indices
```r
mkdir antismash/D1/mapping &&
mkdir antismash/D2/mapping &&
mkdir antismash/D3/mapping &&
mkdir antismash/D4/mapping
cat antismash/D1/*.fna > antismash/D1/cat_D1.fna &&
cat antismash/D2/*.fna > antismash/D2/cat_D2.fna &&
cat antismash/D3/*.fna > antismash/D3/cat_D3.fna &&
cat antismash/D4/*.fna > antismash/D4/cat_D4.fna
bwa index antismash/D1/cat_D1.fna &&
bwa index antismash/D2/cat_D2.fna &&
bwa index antismash/D3/cat_D3.fna &&
bwa index antismash/D4/cat_D4.fna
```
#BWA align RNA against secondary metabolites
```r
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/RNA/raw_data/R1_1/R1_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_1/R1_1_cleaned_rev.fq.gz > antismash/D1/mapping/R1_1.sam &&
samtools view -S -b antismash/D1/mapping/R1_1.sam > antismash/D1/mapping/R1_1.bam -@ 32 &&
samtools sort antismash/D1/mapping/R1_1.bam -o antismash/D1/mapping/R1_1_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/R1_1_sort.bam -@ 32 &&
rm antismash/D1/mapping/R1_1.sam &&
rm antismash/D1/mapping/R1_1.bam &&
pigz antismash/D1/mapping/R1_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/RNA/raw_data/R1_2/R1_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_2/R1_2_cleaned_rev.fq.gz > antismash/D1/mapping/R1_2.sam &&
samtools view -S -b antismash/D1/mapping/R1_2.sam > antismash/D1/mapping/R1_2.bam -@ 32 &&
samtools sort antismash/D1/mapping/R1_2.bam -o antismash/D1/mapping/R1_2_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/R1_2_sort.bam -@ 32 &&
rm antismash/D1/mapping/R1_2.sam &&
rm antismash/D1/mapping/R1_2.bam &&
pigz antismash/D1/mapping/R1_2_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/RNA/raw_data/R1_3/R1_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_3/R1_3_cleaned_rev.fq.gz > antismash/D1/mapping/R1_3.sam &&
samtools view -S -b antismash/D1/mapping/R1_3.sam > antismash/D1/mapping/R1_3.bam -@ 32 &&
samtools sort antismash/D1/mapping/R1_3.bam -o antismash/D1/mapping/R1_3_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/R1_3_sort.bam -@ 32 &&
rm antismash/D1/mapping/R1_3.sam &&
rm antismash/D1/mapping/R1_3.bam &&
pigz antismash/D1/mapping/R1_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/RNA/raw_data/R1_4/R1_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_4/R1_4_cleaned_rev.fq.gz > antismash/D1/mapping/R1_4.sam &&
samtools view -S -b antismash/D1/mapping/R1_4.sam > antismash/D1/mapping/R1_4.bam -@ 32 &&
samtools sort antismash/D1/mapping/R1_4.bam -o antismash/D1/mapping/R1_4_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/R1_4_sort.bam -@ 32 &&
rm antismash/D1/mapping/R1_4.sam &&
rm antismash/D1/mapping/R1_4.bam &&
pigz antismash/D1/mapping/R1_4_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/RNA/raw_data/R1_5/R1_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R1_5/R1_5_cleaned_rev.fq.gz > antismash/D1/mapping/R1_5.sam &&
samtools view -S -b antismash/D1/mapping/R1_5.sam > antismash/D1/mapping/R1_5.bam -@ 32 &&
samtools sort antismash/D1/mapping/R1_5.bam -o antismash/D1/mapping/R1_5_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/R1_5_sort.bam -@ 32 &&
rm antismash/D1/mapping/R1_5.sam &&
rm antismash/D1/mapping/R1_5.bam &&
pigz antismash/D1/mapping/R1_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/RNA/raw_data/R2_1/R2_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_1/R2_1_cleaned_rev.fq.gz > antismash/D2/mapping/R2_1.sam &&
samtools view -S -b antismash/D2/mapping/R2_1.sam > antismash/D2/mapping/R2_1.bam -@ 32 &&
samtools sort antismash/D2/mapping/R2_1.bam -o antismash/D2/mapping/R2_1_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/R2_1_sort.bam -@ 32 &&
rm antismash/D2/mapping/R2_1.sam &&
rm antismash/D2/mapping/R2_1.bam &&
pigz antismash/D2/mapping/R2_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/RNA/raw_data/R2_2/R2_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_2/R2_2_cleaned_rev.fq.gz > antismash/D2/mapping/R2_2.sam &&
samtools view -S -b antismash/D2/mapping/R2_2.sam > antismash/D2/mapping/R2_2.bam -@ 32 &&
samtools sort antismash/D2/mapping/R2_2.bam -o antismash/D2/mapping/R2_2_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/R2_2_sort.bam -@ 32 &&
rm antismash/D2/mapping/R2_2.sam &&
rm antismash/D2/mapping/R2_2.bam &&
pigz antismash/D2/mapping/R2_2_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/RNA/raw_data/R2_3/R2_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_3/R2_3_cleaned_rev.fq.gz > antismash/D2/mapping/R2_3.sam &&
samtools view -S -b antismash/D2/mapping/R2_3.sam > antismash/D2/mapping/R2_3.bam -@ 32 &&
samtools sort antismash/D2/mapping/R2_3.bam -o antismash/D2/mapping/R2_3_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/R2_3_sort.bam -@ 32 &&
rm antismash/D2/mapping/R2_3.sam &&
rm antismash/D2/mapping/R2_3.bam &&
pigz antismash/D2/mapping/R2_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/RNA/raw_data/R2_4/R2_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_4/R2_4_cleaned_rev.fq.gz > antismash/D2/mapping/R2_4.sam &&
samtools view -S -b antismash/D2/mapping/R2_4.sam > antismash/D2/mapping/R2_4.bam -@ 32 &&
samtools sort antismash/D2/mapping/R2_4.bam -o antismash/D2/mapping/R2_4_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/R2_4_sort.bam -@ 32 &&
rm antismash/D2/mapping/R2_4.sam &&
rm antismash/D2/mapping/R2_4.bam &&
pigz antismash/D2/mapping/R2_4_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/RNA/raw_data/R2_5/R2_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R2_5/R2_5_cleaned_rev.fq.gz > antismash/D2/mapping/R2_5.sam &&
samtools view -S -b antismash/D2/mapping/R2_5.sam > antismash/D2/mapping/R2_5.bam -@ 32 &&
samtools sort antismash/D2/mapping/R2_5.bam -o antismash/D2/mapping/R2_5_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/R2_5_sort.bam -@ 32 &&
rm antismash/D2/mapping/R2_5.sam &&
rm antismash/D2/mapping/R2_5.bam &&
pigz antismash/D2/mapping/R2_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/RNA/raw_data/R3_1/R3_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_1/R3_1_cleaned_rev.fq.gz > antismash/D3/mapping/R3_1.sam &&
samtools view -S -b antismash/D3/mapping/R3_1.sam > antismash/D3/mapping/R3_1.bam -@ 32 &&
samtools sort antismash/D3/mapping/R3_1.bam -o antismash/D3/mapping/R3_1_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/R3_1_sort.bam -@ 32 &&
rm antismash/D3/mapping/R3_1.sam &&
rm antismash/D3/mapping/R3_1.bam &&
pigz antismash/D3/mapping/R3_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/RNA/raw_data/R3_2/R3_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_2/R3_2_cleaned_rev.fq.gz > antismash/D3/mapping/R3_2.sam &&
samtools view -S -b antismash/D3/mapping/R3_2.sam > antismash/D3/mapping/R3_2.bam -@ 32 &&
samtools sort antismash/D3/mapping/R3_2.bam -o antismash/D3/mapping/R3_2_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/R3_2_sort.bam -@ 32 &&
rm antismash/D3/mapping/R3_2.sam &&
rm antismash/D3/mapping/R3_2.bam &&
pigz antismash/D3/mapping/R3_2_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/RNA/raw_data/R3_3/R3_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_3/R3_3_cleaned_rev.fq.gz > antismash/D3/mapping/R3_3.sam &&
samtools view -S -b antismash/D3/mapping/R3_3.sam > antismash/D3/mapping/R3_3.bam -@ 32 &&
samtools sort antismash/D3/mapping/R3_3.bam -o antismash/D3/mapping/R3_3_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/R3_3_sort.bam -@ 32 &&
rm antismash/D3/mapping/R3_3.sam &&
rm antismash/D3/mapping/R3_3.bam &&
pigz antismash/D3/mapping/R3_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/RNA/raw_data/R3_4/R3_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_4/R3_4_cleaned_rev.fq.gz > antismash/D3/mapping/R3_4.sam &&
samtools view -S -b antismash/D3/mapping/R3_4.sam > antismash/D3/mapping/R3_4.bam -@ 32 &&
samtools sort antismash/D3/mapping/R3_4.bam -o antismash/D3/mapping/R3_4_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/R3_4_sort.bam -@ 32 &&
rm antismash/D3/mapping/R3_4.sam &&
rm antismash/D3/mapping/R3_4.bam &&
pigz antismash/D3/mapping/R3_4_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/RNA/raw_data/R3_5/R3_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R3_5/R3_5_cleaned_rev.fq.gz > antismash/D3/mapping/R3_5.sam &&
samtools view -S -b antismash/D3/mapping/R3_5.sam > antismash/D3/mapping/R3_5.bam -@ 32 &&
samtools sort antismash/D3/mapping/R3_5.bam -o antismash/D3/mapping/R3_5_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/R3_5_sort.bam -@ 32 &&
rm antismash/D3/mapping/R3_5.sam &&
rm antismash/D3/mapping/R3_5.bam &&
pigz antismash/D3/mapping/R3_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/RNA/raw_data/R4_1/R4_1_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_1/R4_1_cleaned_rev.fq.gz > antismash/D4/mapping/R4_1.sam &&
samtools view -S -b antismash/D4/mapping/R4_1.sam > antismash/D4/mapping/R4_1.bam -@ 32 &&
samtools sort antismash/D4/mapping/R4_1.bam -o antismash/D4/mapping/R4_1_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/R4_1_sort.bam -@ 32 &&
rm antismash/D4/mapping/R4_1.sam &&
rm antismash/D4/mapping/R4_1.bam &&
pigz antismash/D4/mapping/R4_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/RNA/raw_data/R4_2/R4_2_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_2/R4_2_cleaned_rev.fq.gz > antismash/D4/mapping/R4_2.sam &&
samtools view -S -b antismash/D4/mapping/R4_2.sam > antismash/D4/mapping/R4_2.bam -@ 32 &&
samtools sort antismash/D4/mapping/R4_2.bam -o antismash/D4/mapping/R4_2_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/R4_2_sort.bam -@ 32 &&
rm antismash/D4/mapping/R4_2.sam &&
rm antismash/D4/mapping/R4_2.bam &&
pigz antismash/D4/mapping/R4_2_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/RNA/raw_data/R4_3/R4_3_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_3/R4_3_cleaned_rev.fq.gz > antismash/D4/mapping/R4_3.sam &&
samtools view -S -b antismash/D4/mapping/R4_3.sam > antismash/D4/mapping/R4_3.bam -@ 32 &&
samtools sort antismash/D4/mapping/R4_3.bam -o antismash/D4/mapping/R4_3_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/R4_3_sort.bam -@ 32 &&
rm antismash/D4/mapping/R4_3.sam &&
rm antismash/D4/mapping/R4_3.bam &&
pigz antismash/D4/mapping/R4_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/RNA/raw_data/R4_4/R4_4_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_4/R4_4_cleaned_rev.fq.gz > antismash/D4/mapping/R4_4.sam &&
samtools view -S -b antismash/D4/mapping/R4_4.sam > antismash/D4/mapping/R4_4.bam -@ 32 &&
samtools sort antismash/D4/mapping/R4_4.bam -o antismash/D4/mapping/R4_4_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/R4_4_sort.bam -@ 32 &&
rm antismash/D4/mapping/R4_4.sam &&
rm antismash/D4/mapping/R4_4.bam &&
pigz antismash/D4/mapping/R4_4_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/RNA/raw_data/R4_5/R4_5_cleaned_fwd.fq.gz Diel/RNA/raw_data/R4_5/R4_5_cleaned_rev.fq.gz > antismash/D4/mapping/R4_5.sam &&
samtools view -S -b antismash/D4/mapping/R4_5.sam > antismash/D4/mapping/R4_5.bam -@ 32 &&
samtools sort antismash/D4/mapping/R4_5.bam -o antismash/D4/mapping/R4_5_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/R4_5_sort.bam -@ 32 &&
rm antismash/D4/mapping/R4_5.sam &&
rm antismash/D4/mapping/R4_5.bam &&
pigz antismash/D4/mapping/R4_5_sort.bam -p 32
```

#BWA map DNA against secondary Metabolites
```r
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz > antismash/D1/mapping/D1_1.sam &&
samtools view -S -b antismash/D1/mapping/D1_1.sam > antismash/D1/mapping/D1_1.bam -@ 32 &&
samtools sort antismash/D1/mapping/D1_1.bam -o antismash/D1/mapping/D1_1_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/D1_1_sort.bam -@ 32 &&
rm antismash/D1/mapping/D1_1.sam &&
rm antismash/D1/mapping/D1_1.bam &&
pigz antismash/D1/mapping/D1_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz > antismash/D1/mapping/D1_3.sam &&
samtools view -S -b antismash/D1/mapping/D1_3.sam > antismash/D1/mapping/D1_3.bam -@ 32 &&
samtools sort antismash/D1/mapping/D1_3.bam -o antismash/D1/mapping/D1_3_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/D1_3_sort.bam -@ 32 &&
rm antismash/D1/mapping/D1_3.sam &&
rm antismash/D1/mapping/D1_3.bam &&
pigz antismash/D1/mapping/D1_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D1/cat_D1.fna Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz > antismash/D1/mapping/D1_5.sam &&
samtools view -S -b antismash/D1/mapping/D1_5.sam > antismash/D1/mapping/D1_5.bam -@ 32 &&
samtools sort antismash/D1/mapping/D1_5.bam -o antismash/D1/mapping/D1_5_sort.bam -@ 32 &&
samtools index antismash/D1/mapping/D1_5_sort.bam -@ 32 &&
rm antismash/D1/mapping/D1_5.sam &&
rm antismash/D1/mapping/D1_5.bam &&
pigz antismash/D1/mapping/D1_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz > antismash/D2/mapping/D2_1.sam &&
samtools view -S -b antismash/D2/mapping/D2_1.sam > antismash/D2/mapping/D2_1.bam -@ 32 &&
samtools sort antismash/D2/mapping/D2_1.bam -o antismash/D2/mapping/D2_1_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/D2_1_sort.bam -@ 32 &&
rm antismash/D2/mapping/D2_1.sam &&
rm antismash/D2/mapping/D2_1.bam &&
pigz antismash/D2/mapping/D2_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz > antismash/D2/mapping/D2_3.sam &&
samtools view -S -b antismash/D2/mapping/D2_3.sam > antismash/D2/mapping/D2_3.bam -@ 32 &&
samtools sort antismash/D2/mapping/D2_3.bam -o antismash/D2/mapping/D2_3_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/D2_3_sort.bam -@ 32 &&
rm antismash/D2/mapping/D2_3.sam &&
rm antismash/D2/mapping/D2_3.bam &&
pigz antismash/D2/mapping/D2_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D2/cat_D2.fna Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz > antismash/D2/mapping/D2_5.sam &&
samtools view -S -b antismash/D2/mapping/D2_5.sam > antismash/D2/mapping/D2_5.bam -@ 32 &&
samtools sort antismash/D2/mapping/D2_5.bam -o antismash/D2/mapping/D2_5_sort.bam -@ 32 &&
samtools index antismash/D2/mapping/D2_5_sort.bam -@ 32 &&
rm antismash/D2/mapping/D2_5.sam &&
rm antismash/D2/mapping/D2_5.bam &&
pigz antismash/D2/mapping/D2_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz > antismash/D3/mapping/D3_1.sam &&
samtools view -S -b antismash/D3/mapping/D3_1.sam > antismash/D3/mapping/D3_1.bam -@ 32 &&
samtools sort antismash/D3/mapping/D3_1.bam -o antismash/D3/mapping/D3_1_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/D3_1_sort.bam -@ 32 &&
rm antismash/D3/mapping/D3_1.sam &&
rm antismash/D3/mapping/D3_1.bam &&
pigz antismash/D3/mapping/D3_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz > antismash/D3/mapping/D3_3.sam &&
samtools view -S -b antismash/D3/mapping/D3_3.sam > antismash/D3/mapping/D3_3.bam -@ 32 &&
samtools sort antismash/D3/mapping/D3_3.bam -o antismash/D3/mapping/D3_3_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/D3_3_sort.bam -@ 32 &&
rm antismash/D3/mapping/D3_3.sam &&
rm antismash/D3/mapping/D3_3.bam &&
pigz antismash/D3/mapping/D3_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D3/cat_D3.fna Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz > antismash/D3/mapping/D3_5.sam &&
samtools view -S -b antismash/D3/mapping/D3_5.sam > antismash/D3/mapping/D3_5.bam -@ 32 &&
samtools sort antismash/D3/mapping/D3_5.bam -o antismash/D3/mapping/D3_5_sort.bam -@ 32 &&
samtools index antismash/D3/mapping/D3_5_sort.bam -@ 32 &&
rm antismash/D3/mapping/D3_5.sam &&
rm antismash/D3/mapping/D3_5.bam &&
pigz antismash/D3/mapping/D3_5_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz > antismash/D4/mapping/D4_1.sam &&
samtools view -S -b antismash/D4/mapping/D4_1.sam > antismash/D4/mapping/D4_1.bam -@ 32 &&
samtools sort antismash/D4/mapping/D4_1.bam -o antismash/D4/mapping/D4_1_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/D4_1_sort.bam -@ 32 &&
rm antismash/D4/mapping/D4_1.sam &&
rm antismash/D4/mapping/D4_1.bam &&
pigz antismash/D4/mapping/D4_1_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz > antismash/D4/mapping/D4_3.sam &&
samtools view -S -b antismash/D4/mapping/D4_3.sam > antismash/D4/mapping/D4_3.bam -@ 32 &&
samtools sort antismash/D4/mapping/D4_3.bam -o antismash/D4/mapping/D4_3_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/D4_3_sort.bam -@ 32 &&
rm antismash/D4/mapping/D4_3.sam &&
rm antismash/D4/mapping/D4_3.bam &&
pigz antismash/D4/mapping/D4_3_sort.bam -p 32 &&
bwa mem -t 32 antismash/D4/cat_D4.fna Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz > antismash/D4/mapping/D4_5.sam &&
samtools view -S -b antismash/D4/mapping/D4_5.sam > antismash/D4/mapping/D4_5.bam -@ 32 &&
samtools sort antismash/D4/mapping/D4_5.bam -o antismash/D4/mapping/D4_5_sort.bam -@ 32 &&
samtools index antismash/D4/mapping/D4_5_sort.bam -@ 32 &&
rm antismash/D4/mapping/D4_5.sam &&
rm antismash/D4/mapping/D4_5.bam &&
pigz antismash/D4/mapping/D4_5_sort.bam -p 32
```
#CoverM for RNA against secondary metabolites (TPM)
```r
coverm contig --bam-files antismash/D1/mapping/R1_?_sort.bam -m tpm -t 15 -o antismash/D1/mapping/R1_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D2/mapping/R2_?_sort.bam -m tpm -t 15 -o antismash/D2/mapping/R2_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D3/mapping/R3_?_sort.bam -m tpm -t 15 -o antismash/D3/mapping/R3_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D4/mapping/R4_?_sort.bam -m tpm -t 15 -o antismash/D4/mapping/R4_sec_metab_tpm.tsv
```

#CoverM for DNA against secondary metabolites (TPM)
```r
coverm contig --bam-files antismash/D1/mapping/D1_?_sort.bam -m tpm -t 15 -o antismash/D1/mapping/D1_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D2/mapping/D2_?_sort.bam -m tpm -t 15 -o antismash/D2/mapping/D2_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D3/mapping/D3_?_sort.bam -m tpm -t 15 -o antismash/D3/mapping/D3_sec_metab_tpm.tsv &&
coverm contig --bam-files antismash/D4/mapping/D4_?_sort.bam -m tpm -t 15 -o antismash/D4/mapping/D4_sec_metab_tpm.tsv
```

#iRep for cyano genome replication rate prediction
#First create mappings to just raw Cyano genome fastas
```r
bowtie2-build MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa D1_cyano -f &&
bowtie2-build MEGAHIT/D2/ANVIO/fasta/D2_MAG_00020-contigs.fa D2_cyano -f &&
bowtie2-build MEGAHIT/D3/ANVIO/fasta/D3_MAG_00039-contigs.fa D3_cyano -f &&
bowtie2-build MEGAHIT/D4/ANVIO/fasta/D4_MAG_00020-contigs.fa D4_cyano -f

bowtie2 -x D1_cyano -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_1_cyan.sam -p 32 --reorder &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_1_cyan.sam > MEGAHIT/D1/DNA_MAPS/D1_1_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_1_cyan.bam -o MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_cyan.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_cyan.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.bam -p 32 &&
bowtie2 -x D1_cyano -1 Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_3_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_3_cyan.sam > MEGAHIT/D1/DNA_MAPS/D1_3_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_3_cyan.bam -o MEGAHIT/D1/DNA_MAPS/D1_3_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_3_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_cyan.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_cyan.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_3_sort_cyan.bam -p 32 &&
bowtie2 -x D1_cyano -1 Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_5_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_5_cyan.sam > MEGAHIT/D1/DNA_MAPS/D1_5_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_5_cyan.bam -o MEGAHIT/D1/DNA_MAPS/D1_5_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_5_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_cyan.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_cyan.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_5_sort_cyan.bam -p 32 &&
bowtie2 -x D2_cyano -1 Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_1_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_1_cyan.sam > MEGAHIT/D2/DNA_MAPS/D2_1_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_1_cyan.bam -o MEGAHIT/D2/DNA_MAPS/D2_1_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_1_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_cyan.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_cyan.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_1_sort_cyan.bam -p 32 &&
bowtie2 -x D2_cyano -1 Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_3_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_3_cyan.sam > MEGAHIT/D2/DNA_MAPS/D2_3_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_3_cyan.bam -o MEGAHIT/D2/DNA_MAPS/D2_3_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_3_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_cyan.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_cyan.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_3_sort_cyan.bam -p 32 &&
bowtie2 -x D2_cyano -1 Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_5_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_5_cyan.sam > MEGAHIT/D2/DNA_MAPS/D2_5_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_5_cyan.bam -o MEGAHIT/D2/DNA_MAPS/D2_5_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_5_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_cyan.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_cyan.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_5_sort_cyan.bam -p 32 &&
bowtie2 -x D3_cyano -1 Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_1_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_1_cyan.sam > MEGAHIT/D3/DNA_MAPS/D3_1_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_1_cyan.bam -o MEGAHIT/D3/DNA_MAPS/D3_1_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_1_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_cyan.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_cyan.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_1_sort_cyan.bam -p 32 &&
bowtie2 -x D3_cyano -1 Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_3_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_3_cyan.sam > MEGAHIT/D3/DNA_MAPS/D3_3_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_3_cyan.bam -o MEGAHIT/D3/DNA_MAPS/D3_3_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_3_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_cyan.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_cyan.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_3_sort_cyan.bam -p 32 &&
bowtie2 -x D3_cyano -1 Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_5_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_5_cyan.sam > MEGAHIT/D3/DNA_MAPS/D3_5_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_5_cyan.bam -o MEGAHIT/D3/DNA_MAPS/D3_5_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_5_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_cyan.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_cyan.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_5_sort_cyan.bam -p 32 &&
bowtie2 -x D4_cyano -1 Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_1_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_1_cyan.sam > MEGAHIT/D4/DNA_MAPS/D4_1_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_1_cyan.bam -o MEGAHIT/D4/DNA_MAPS/D4_1_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_1_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_cyan.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_cyan.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_1_sort_cyan.bam -p 32 &&
bowtie2 -x D4_cyano -1 Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_3_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_3_cyan.sam > MEGAHIT/D4/DNA_MAPS/D4_3_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_3_cyan.bam -o MEGAHIT/D4/DNA_MAPS/D4_3_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_3_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_cyan.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_cyan.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_3_sort_cyan.bam -p 32 &&
bowtie2 -x D4_cyano -1 Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_5_cyan.sam -p 32 &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_5_cyan.sam > MEGAHIT/D4/DNA_MAPS/D4_5_cyan.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_5_cyan.bam -o MEGAHIT/D4/DNA_MAPS/D4_5_sort_cyan.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_5_sort_cyan.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_cyan.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_cyan.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_5_sort_cyan.bam -p 32
```
#Actually, we needed SAM Files for some annoying reason, so convert back
```r
samtools view -h MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.bam > MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.sam -@ 32
```
#Now run iRep
```
iRep -f MEGAHIT/D1/ANVIO/fasta/D1_MAG_00014-contigs.fa -s MEGAHIT/D1/DNA_MAPS/D1_1_sort_cyan.sam -o D1_1_irep --sort -t 30
```

############GET PER GENE REGION TPM for DNA to compare with RNA and make master plot FIG 6
#Build bowtie index of MAGs using DRAM scaffolds as base for later feature counts pulling
```r
bowtie2-build MEGAHIT/D1/uniDRAM/scaffolds.fna MEGAHIT/D1/DNA_MAPS/D1_MAG -f &&
bowtie2-build MEGAHIT/D2/uniDRAM/scaffolds.fna MEGAHIT/D2/DNA_MAPS/D2_MAG -f &&
bowtie2-build MEGAHIT/D3/uniDRAM/scaffolds.fna MEGAHIT/D3/DNA_MAPS/D3_MAG -f &&
bowtie2-build MEGAHIT/D4/uniDRAM/scaffolds.fna MEGAHIT/D4/DNA_MAPS/D4_MAG -f
```
#Map DNA against Genomes
```r
bowtie2 -x MEGAHIT/D1/DNA_MAPS/D1_MAG -1 Diel/DNA/raw_data/D1_1/D1_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_1/D1_1_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.sam > MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.bam -o MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_1_mag_map.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_1_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D1/DNA_MAPS/D1_MAG -1 Diel/DNA/raw_data/D1_3/D1_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_3/D1_3_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.sam > MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.bam -o MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_3_mag_map.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_3_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D1/DNA_MAPS/D1_MAG -1 Diel/DNA/raw_data/D1_5/D1_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D1_5/D1_5_2_fin_qc.fq.gz -S MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.sam > MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.bam -o MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.sam &&
rm MEGAHIT/D1/DNA_MAPS/D1_5_mag_map.bam &&
pigz MEGAHIT/D1/DNA_MAPS/D1_5_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/DNA_MAPS/D2_MAG -1 Diel/DNA/raw_data/D2_1/D2_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_1/D2_1_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.sam > MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.bam -o MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_1_mag_map.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_1_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/DNA_MAPS/D2_MAG -1 Diel/DNA/raw_data/D2_3/D2_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_3/D2_3_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.sam > MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.bam -o MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_3_mag_map.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_3_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D2/DNA_MAPS/D2_MAG -1 Diel/DNA/raw_data/D2_5/D2_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D2_5/D2_5_2_fin_qc.fq.gz -S MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.sam > MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.bam -o MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.sam &&
rm MEGAHIT/D2/DNA_MAPS/D2_5_mag_map.bam &&
pigz MEGAHIT/D2/DNA_MAPS/D2_5_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/DNA_MAPS/D3_MAG -1 Diel/DNA/raw_data/D3_1/D3_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_1/D3_1_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.sam > MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.bam -o MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_1_mag_map.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_1_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/DNA_MAPS/D3_MAG -1 Diel/DNA/raw_data/D3_3/D3_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_3/D3_3_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.sam > MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.bam -o MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_3_mag_map.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_3_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D3/DNA_MAPS/D3_MAG -1 Diel/DNA/raw_data/D3_5/D3_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D3_5/D3_5_2_fin_qc.fq.gz -S MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.sam > MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.bam -o MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.sam &&
rm MEGAHIT/D3/DNA_MAPS/D3_5_mag_map.bam &&
pigz MEGAHIT/D3/DNA_MAPS/D3_5_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/DNA_MAPS/D4_MAG -1 Diel/DNA/raw_data/D4_1/D4_1_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_1/D4_1_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.sam > MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.bam -o MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_1_mag_map.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_1_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/DNA_MAPS/D4_MAG -1 Diel/DNA/raw_data/D4_3/D4_3_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_3/D4_3_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.sam > MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.bam -o MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_3_mag_map.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_3_sort_mag_map.bam -p 32 &&
bowtie2 -x MEGAHIT/D4/DNA_MAPS/D4_MAG -1 Diel/DNA/raw_data/D4_5/D4_5_1_fin_qc.fq.gz -2 Diel/DNA/raw_data/D4_5/D4_5_2_fin_qc.fq.gz -S MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.sam -p 32 --no-unal &&
samtools view -S -b MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.sam > MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.bam -@ 32 &&
samtools sort MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.bam -o MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag_map.bam -@ 32 &&
samtools index MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag_map.bam -@ 32 &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.sam &&
rm MEGAHIT/D4/DNA_MAPS/D4_5_mag_map.bam &&
pigz MEGAHIT/D4/DNA_MAPS/D4_5_sort_mag_map.bam -p 32
```

#Use featureCounts ver. 2.0.1 to extract counts per gene region on MAGs (DNA for DNA/RNA FIG 6 of Diel Manuscript)
```r
pigz -p 30 -d MEGAHIT/D?/DNA_MAPS/D?_?_sort_mag_mag_map.bam &&
featureCounts -a MEGAHIT/D1/uniDRAM/genes.gff -o MEGAHIT/D1/DNA_MAPS/D1_DNA_counts.tsv MEGAHIT/D1/DNA_MAPS/D1_?_sort_mag_map.bam -T 20 -F GFF -t CDS -g ID -p &&
featureCounts -a MEGAHIT/D2/uniDRAM/genes.gff -o MEGAHIT/D2/DNA_MAPS/D2_DNA_counts.tsv MEGAHIT/D2/DNA_MAPS/D2_?_sort_mag_map.bam -T 20 -F GFF -t CDS -g ID -p &&
featureCounts -a MEGAHIT/D3/uniDRAM/genes.gff -o MEGAHIT/D3/DNA_MAPS/D3_DNA_counts.tsv MEGAHIT/D3/DNA_MAPS/D3_?_sort_mag_map.bam -T 20 -F GFF -t CDS -g ID -p &&
featureCounts -a MEGAHIT/D4/uniDRAM/genes.gff -o MEGAHIT/D4/DNA_MAPS/D4_DNA_counts.tsv MEGAHIT/D4/DNA_MAPS/D4_?_sort_mag_map.bam -T 20 -F GFF -t CDS -g ID -p
```
